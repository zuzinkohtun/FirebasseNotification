import{registerVersion as e,_registerComponent as t,_getProvider,getApp as n}from"https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";class FirebaseError extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var n,t=t[0]||{},i=this.service+"/"+e,e=this.errors[e],e=e?(n=t,e.replace(r,(e,t)=>{var r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",e=this.serviceName+`: ${e} (${i}).`;return new FirebaseError(i,e,t)}}const r=/\{\$([^}]+)}/g;function deepEqual(e,t){if(e===t)return!0;const r=Object.keys(e),n=Object.keys(t);for(const i of r){if(!n.includes(i))return!1;const r=e[i],a=t[i];if(isObject(r)&&isObject(a)){if(!deepEqual(r,a))return!1}else if(r!==a)return!1}for(const e of n)if(!r.includes(e))return!1;return!0}function isObject(e){return null!==e&&"object"==typeof e}function getModularInstance(e){return e&&e._delegate?e._delegate:e}var i,M;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i=i||{});const o={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},a=i.INFO,s={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},defaultLogHandler=(e,t,...r)=>{if(!(t<e.logLevel)){var n=(new Date).toISOString(),i=s[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${n}]  ${e.name}:`,...r)}};class Component{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let c,u;const l=new WeakMap,p=new WeakMap,g=new WeakMap,d=new WeakMap,f=new WeakMap;let h={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return p.get(e);if("objectStoreNames"===t)return e.objectStoreNames||g.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return wrap(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function wrapFunction(r){return r!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(u=u||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(r)?function(...e){return r.apply(unwrap(this),e),wrap(l.get(this))}:function(...e){return wrap(r.apply(unwrap(this),e))}:function(e,...t){t=r.call(unwrap(this),e,...t);return g.set(t,e.sort?e.sort():[e]),wrap(t)}}function transformCachableValue(e){return"function"==typeof e?wrapFunction(e):(e instanceof IDBTransaction&&(a=e,p.has(a)||(t=new Promise((e,t)=>{const r=()=>{a.removeEventListener("complete",n),a.removeEventListener("error",i),a.removeEventListener("abort",i)},n=()=>{e(),r()},i=()=>{t(a.error||new DOMException("AbortError","AbortError")),r()};a.addEventListener("complete",n),a.addEventListener("error",i),a.addEventListener("abort",i)}),p.set(a,t))),r=e,(c=c||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]).some(e=>r instanceof e)?new Proxy(e,h):e);var a,t,r}function wrap(e){if(e instanceof IDBRequest){var a=e;const r=new Promise((e,t)=>{const r=()=>{a.removeEventListener("success",n),a.removeEventListener("error",i)},n=()=>{e(wrap(a.result)),r()},i=()=>{t(a.error),r()};a.addEventListener("success",n),a.addEventListener("error",i)});return r.then(e=>{e instanceof IDBCursor&&l.set(e,a)}).catch(()=>{}),f.set(r,a),r}if(d.has(e))return d.get(e);var t=transformCachableValue(e);return t!==e&&(d.set(e,t),f.set(t,e)),t}const unwrap=e=>f.get(e),m=["get","getKey","getAll","getAllKeys","count"],v=["put","add","delete","clear"],b=new Map;function getMethod(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(b.get(t))return b.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,a=v.includes(n);return n in(i?IDBIndex:IDBObjectStore).prototype&&(a||m.includes(n))?(e=async function(e,...t){e=this.transaction(e,a?"readwrite":"readonly");let r=e.store;return i&&(r=r.index(t.shift())),(await Promise.all([r[n](...t),a&&e.done]))[0]},b.set(t,e),e):void 0}}!function(e){h=e(h)}(n=>({...n,get:(e,t,r)=>getMethod(e,t)||n.get(e,t,r),has:(e,t)=>!!getMethod(e,t)||n.has(e,t)}));const w="@firebase/installations",T=new ErrorFactory("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function isServerError(e){return e instanceof FirebaseError&&e.code.includes("request-failed")}function getInstallationsEndpoint({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function extractAuthTokenInfoFromResponse(e){return{token:e.token,requestStatus:2,expiresIn:(e=e.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()}}async function getErrorFromResponse(e,t){t=(await t.json()).error;return T.create("request-failed",{requestName:e,serverCode:t.code,serverMessage:t.message,serverStatus:t.status})}function getHeaders({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function getHeadersWithAuth(e,{refreshToken:t}){const r=getHeaders(e);return r.append("Authorization","FIS_v2 "+t),r}async function retryIfServerError(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function sleep(t){return new Promise(e=>{setTimeout(e,t)})}const E=/^[cdef][\w-]{21}$/;function generateFid(){try{const r=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(r),r[0]=112+r[0]%16;t=r;var e=btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22);return E.test(e)?e:""}catch(e){return""}var t}function getKey(e){return e.appName+"!"+e.appId}const I=new Map;function fidChanged(e,t){e=getKey(e);callFidChangeCallbacks(e,t);{!y&&"BroadcastChannel"in self&&((y=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{callFidChangeCallbacks(e.data.key,e.data.fid)});const r=y;return r&&r.postMessage({key:e,fid:t}),void(0===I.size&&y&&(y.close(),y=null))}}function callFidChangeCallbacks(e,t){var r=I.get(e);if(r)for(const e of r)e(t)}let y=null;const S="firebase-installations-store";let _=null;function getDbPromise(){return _=_||function(e,t,{blocked:r,upgrade:n,blocking:i,terminated:a}){const o=indexedDB.open(e,t),s=wrap(o);return n&&o.addEventListener("upgradeneeded",e=>{n(wrap(o.result),e.oldVersion,e.newVersion,wrap(o.transaction),e)}),r&&o.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),s.then(e=>{a&&e.addEventListener("close",()=>a()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(S)}})}async function set(e,t){const r=getKey(e),n=(await getDbPromise()).transaction(S,"readwrite"),i=n.objectStore(S),a=await i.get(r);return await i.put(t,r),await n.done,a&&a.fid===t.fid||fidChanged(e,t.fid),t}async function remove(e){const t=getKey(e),r=(await getDbPromise()).transaction(S,"readwrite");await r.objectStore(S).delete(t),await r.done}async function update(e,t){const r=getKey(e),n=(await getDbPromise()).transaction(S,"readwrite"),i=n.objectStore(S),a=await i.get(r),o=t(a);return void 0===o?await i.delete(r):await i.put(o,r),await n.done,!o||a&&a.fid===o.fid||fidChanged(e,o.fid),o}async function getInstallationEntry(t){let r;var e=await update(t.appConfig,e=>{e=clearTimedOutRequest(e||{fid:generateFid(),registrationStatus:0}),e=function(e,t){if(0!==t.registrationStatus)return 1===t.registrationStatus?{installationEntry:t,registrationPromise:waitUntilFidRegistration(e)}:{installationEntry:t};if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(T.create("app-offline"))};t={fid:t.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:t,registrationPromise:async function(t,r){try{var e=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:r}){const n=getInstallationsEndpoint(e),i=getHeaders(e),a=t.getImmediate({optional:!0});if(a){const e=await a.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={fid:r,authVersion:"FIS_v2",appId:e.appId,sdkVersion:"w:0.6.4"},s={method:"POST",headers:i,body:JSON.stringify(o)},c=await retryIfServerError(()=>fetch(n,s));if(c.ok){const e=await c.json();return{fid:e.fid||r,registrationStatus:2,refreshToken:e.refreshToken,authToken:extractAuthTokenInfoFromResponse(e.authToken)}}throw await getErrorFromResponse("Create Installation",c)}(t,r);return set(t.appConfig,e)}catch(e){throw isServerError(e)&&409===e.customData.serverCode?await remove(t.appConfig):await set(t.appConfig,{fid:r.fid,registrationStatus:0}),e}}(e,t)}}(t,e);return r=e.registrationPromise,e.installationEntry});return""===e.fid?{installationEntry:await r}:{installationEntry:e,registrationPromise:r}}async function waitUntilFidRegistration(e){let t=await updateInstallationRequest(e.appConfig);for(;1===t.registrationStatus;)await sleep(100),t=await updateInstallationRequest(e.appConfig);if(0!==t.registrationStatus)return t;{const{installationEntry:t,registrationPromise:r}=await getInstallationEntry(e);return r||t}}function updateInstallationRequest(e){return update(e,e=>{if(e)return clearTimedOutRequest(e);throw T.create("installation-not-found")})}function clearTimedOutRequest(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function generateAuthTokenRequest({appConfig:e,heartbeatServiceProvider:t},r){[o,s]=[e,r["fid"]];const n=getInstallationsEndpoint(o)+`/${s}/authTokens:generate`,i=getHeadersWithAuth(e,r),a=t.getImmediate({optional:!0});var o,s;if(a){const e=await a.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const c={installation:{sdkVersion:"w:0.6.4",appId:e.appId}},l={method:"POST",headers:i,body:JSON.stringify(c)},u=await retryIfServerError(()=>fetch(n,l));if(u.ok)return extractAuthTokenInfoFromResponse(await u.json());throw await getErrorFromResponse("Generate Auth Token",u)}async function refreshAuthToken(i,a=!1){let o;var e=await update(i.appConfig,e=>{if(!isEntryRegistered(e))throw T.create("not-registered");var t,r,n=e.authToken;if(!(a||(2!==(t=n).requestStatus||(t=t,(r=Date.now())<t.creationTime||t.creationTime+t.expiresIn<r+36e5))))return e;if(1===n.requestStatus)return o=async function(e,t){let r=await updateAuthTokenRequest(e.appConfig);for(;1===r.authToken.requestStatus;)await sleep(100),r=await updateAuthTokenRequest(e.appConfig);var n=r.authToken;return 0===n.requestStatus?refreshAuthToken(e,t):n}(i,a),e;{if(!navigator.onLine)throw T.create("app-offline");t=e,r={requestStatus:1,requestTime:Date.now()};const a=Object.assign(Object.assign({},t),{authToken:r});return o=async function(t,r){try{var e=await generateAuthTokenRequest(t,r),n=Object.assign(Object.assign({},r),{authToken:e});return await set(t.appConfig,n),e}catch(e){throw!isServerError(e)||401!==e.customData.serverCode&&404!==e.customData.serverCode?(n=Object.assign(Object.assign({},r),{authToken:{requestStatus:0}}),await set(t.appConfig,n)):await remove(t.appConfig),e}}(i,a),a}});return o?await o:e.authToken}function updateAuthTokenRequest(e){return update(e,e=>{if(isEntryRegistered(e))return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;throw T.create("not-registered");var t})}function isEntryRegistered(e){return void 0!==e&&2===e.registrationStatus}async function getToken(e,t=!1){var r=e;return(r=(await getInstallationEntry(r)).registrationPromise)&&await r,await 0,(await refreshAuthToken(e,t)).token}function getMissingValueError(e){return T.create("missing-app-config-values",{valueName:e})}const publicFactory=e=>{e=e.getProvider("app").getImmediate();return{app:e,appConfig:function(e){if(!e||!e.options)throw getMissingValueError("App Configuration");if(!e.name)throw getMissingValueError("App Name");for(const t of["projectId","apiKey","appId"])if(!e.options[t])throw getMissingValueError(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(e),heartbeatServiceProvider:_getProvider(e,"heartbeat"),_delete:()=>Promise.resolve()}},internalFactory=e=>{const t=e.getProvider("app").getImmediate(),r=_getProvider(t,"installations").getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:r,registrationPromise:n}=await getInstallationEntry(t);return(n||refreshAuthToken(t)).catch(console.error),r.fid}(r),getToken:e=>getToken(r,e)}},A=(t(new Component("installations",publicFactory,"PUBLIC")),t(new Component("installations-internal",internalFactory,"PRIVATE")),e(w,"0.6.4"),e(w,"0.6.4","esm2017"),"@firebase/performance"),k=new ErrorFactory("performance","Performance",{"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."}),R=new class{constructor(e){this.name=e,this._logLevel=a,this._logHandler=defaultLogHandler,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?o[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...e),this._logHandler(this,i.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...e),this._logHandler(this,i.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,i.INFO,...e),this._logHandler(this,i.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,i.WARN,...e),this._logHandler(this,i.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,i.ERROR,...e),this._logHandler(this,i.ERROR,...e)}}("Performance");let C,N,O,P;R.logLevel=i.INFO;class Api{constructor(e){if(!(this.window=e))throw k.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){this.performance&&this.performance.mark&&this.performance.mark(e)}measure(e,t,r){this.performance&&this.performance.measure&&this.performance.measure(e,t,r)}getEntriesByType(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]}getEntriesByName(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return fetch&&Promise&&"undefined"!=typeof navigator&&navigator.cookieEnabled?!!function(){try{return"object"==typeof indexedDB}catch(e){return}}()||(R.info("IndexedDB is not supported by current browser"),!1):(R.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)}setupObserver(e,r){this.PerformanceObserver&&new this.PerformanceObserver(e=>{for(const t of e.getEntries())r(t)}).observe({entryTypes:[e]})}static getInstance(){return C=void 0===C?new Api(N):C}}function getIid(){return O}function mergeStrings(t,r){var e=t.length-r.length;if(e<0||1<e)throw k.create("invalid String merger input");const n=[];for(let e=0;e<t.length;e++)n.push(t.charAt(e)),r.length>e&&n.push(r.charAt(e));return n.join("")}class SettingsService{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=mergeStrings("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=mergeStrings("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return P=void 0===P?new SettingsService:P}}!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.VISIBLE=1]="VISIBLE",e[e.HIDDEN=2]="HIDDEN"}(M=M||{});const D=["firebase_","google_","ga_"],L=new RegExp("^[a-zA-Z]\\w*$");function getServiceWorkerStatus(){var e=Api.getInstance().navigator;return null!=e&&e.serviceWorker?e.serviceWorker.controller?2:3:1}function getVisibilityState(){switch(Api.getInstance().document.visibilityState){case"visible":return M.VISIBLE;case"hidden":return M.HIDDEN;default:return M.UNKNOWN}}function getEffectiveConnectionType(){var e=Api.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}function getAppId(e){e=null==(e=e.options)?void 0:e.appId;if(e)return e;throw k.create("no app id")}const F={loggingEnabled:!0};function getConfig(e,t){var n,i,r=function(){const e=Api.getInstance().localStorage;if(e){var t=e.getItem("@firebase/performance/configexpire");if(t&&Number(t)>Date.now()){t=e.getItem("@firebase/performance/config");if(t)try{return JSON.parse(t)}catch(e){return}}}}();return r?(processConfig(r),Promise.resolve()):(i=t,function(e){const t=e.getToken();return t.then(e=>{}),t}((n=e).installations).then(e=>{var t=function(e){e=null==(e=e.options)?void 0:e.projectId;if(e)return e;throw k.create("no project id")}(n.app),r=function(e){e=null==(e=e.options)?void 0:e.apiKey;if(e)return e;throw k.create("no api key")}(n.app),t=new Request(`https://firebaseremoteconfig.googleapis.com/v1/projects/${t}/namespaces/fireperf:fetch?key=`+r,{method:"POST",headers:{Authorization:"FIREBASE_INSTALLATIONS_AUTH "+e},body:JSON.stringify({app_instance_id:i,app_instance_id_token:e,app_id:getAppId(n.app),app_version:"0.6.4",sdk_version:"0.0.1"})});return fetch(t).then(e=>{if(e.ok)return e.json();throw k.create("RC response not ok")})}).catch(()=>{R.info("Could not fetch config, will use default configs")}).then(processConfig).then(e=>{{const t=Api.getInstance().localStorage;return void(e&&t&&(t.setItem("@firebase/performance/config",JSON.stringify(e)),t.setItem("@firebase/performance/configexpire",String(Date.now()+60*SettingsService.getInstance().configTimeToLive*60*1e3))))}},()=>{}))}function processConfig(e){if(!e)return e;const t=SettingsService.getInstance(),r=e.entries||{};return void 0!==r.fpr_enabled?t.loggingEnabled="true"===String(r.fpr_enabled):t.loggingEnabled=F.loggingEnabled,r.fpr_log_source?t.logSource=Number(r.fpr_log_source):F.logSource&&(t.logSource=F.logSource),r.fpr_log_endpoint_url?t.logEndPointUrl=r.fpr_log_endpoint_url:F.logEndPointUrl&&(t.logEndPointUrl=F.logEndPointUrl),r.fpr_log_transport_key?t.transportKey=r.fpr_log_transport_key:F.transportKey&&(t.transportKey=F.transportKey),void 0!==r.fpr_vc_network_request_sampling_rate?t.networkRequestsSamplingRate=Number(r.fpr_vc_network_request_sampling_rate):void 0!==F.networkRequestsSamplingRate&&(t.networkRequestsSamplingRate=F.networkRequestsSamplingRate),void 0!==r.fpr_vc_trace_sampling_rate?t.tracesSamplingRate=Number(r.fpr_vc_trace_sampling_rate):void 0!==F.tracesSamplingRate&&(t.tracesSamplingRate=F.tracesSamplingRate),t.logTraceAfterSampling=shouldLogAfterSampling(t.tracesSamplingRate),t.logNetworkAfterSampling=shouldLogAfterSampling(t.networkRequestsSamplingRate),e}function shouldLogAfterSampling(e){return Math.random()<=e}let B,q=1;function getInitializationPromise(e){return q=2,B=B||(r=e,function(){const r=Api.getInstance().document;return new Promise(e=>{if(r&&"complete"!==r.readyState){const t=()=>{"complete"===r.readyState&&(r.removeEventListener("readystatechange",t),e())};r.addEventListener("readystatechange",t)}else e()})}().then(()=>{{var e;const t=r.installations.getId();return t.then(e=>{O=e}),t}}).then(e=>getConfig(r,e)).then(()=>changeInitializationStatus(),()=>changeInitializationStatus()));var r}function changeInitializationStatus(){q=3}let j,U=3,$=[],H=!1;function processQueue(e){setTimeout(()=>{if(0!==U)if($.length){const r=$.splice(0,1e3),i=r.map(e=>({source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)}));var e,n,t;e={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:SettingsService.getInstance().logSource,log_event:i},n=r,e=e,t=SettingsService.getInstance().getFlTransportFullUrl(),fetch(t,{method:"POST",body:JSON.stringify(e)}).then(e=>(e.ok||R.info("Call to Firebase backend failed."),e.json())).then(e=>{var t=Number(e.nextRequestWaitMillis);let r=1e4;isNaN(t)||(r=Math.max(t,r));t=e.logResponseDetails;Array.isArray(t)&&0<t.length&&"RETRY_REQUEST_LATER"===t[0].responseAction&&($=[...n,...$],R.info("Retry transport request later.")),U=3,processQueue(r)}).catch(()=>{$=[...r,...$],U--,R.info(`Tries left: ${U}.`),processQueue(1e4)});return}else return processQueue(1e4)},e)}function transportHandler(t){return(...e)=>{e={message:t(...e),eventTime:Date.now()};if(!e.eventTime||!e.message)throw k.create("invalid cc log");$=[...$,e]}}function sendLog(e,t){(j=j||transportHandler(serializer))(e,t)}function logTrace(e){var t=SettingsService.getInstance();!t.instrumentationEnabled&&e.isAuto||!t.dataCollectionEnabled&&!e.isAuto||!Api.getInstance().requiredApisAvailable()||e.isAuto&&getVisibilityState()!==M.VISIBLE||(3!==q?getInitializationPromise(e.performanceController).then(()=>sendTraceLog(e),()=>sendTraceLog(e)):sendTraceLog(e))}function sendTraceLog(e){var t;!getIid()||(t=SettingsService.getInstance()).loggingEnabled&&t.logTraceAfterSampling&&setTimeout(()=>sendLog(e,1),0)}function serializer(e,t){if(0===t)return r={url:(t=e).url,http_method:e.httpMethod||0,http_response_code:200,response_payload_bytes:e.responsePayloadBytes,client_start_time_us:e.startTimeUs,time_to_response_initiated_us:e.timeToResponseInitiatedUs,time_to_response_completed_us:e.timeToResponseCompletedUs},t={application_info:getApplicationInfo(e.performanceController.app),network_request_metric:r},JSON.stringify(t);{r=e;const n={name:r.name,is_auto:r.isAuto,client_start_time_us:r.startTimeUs,duration_us:r.durationUs};0!==Object.keys(r.counters).length&&(n.counters=r.counters);t=r.getAttributes(),t=(0!==Object.keys(t).length&&(n.custom_attributes=t),{application_info:getApplicationInfo(r.performanceController.app),trace_metric:n});return JSON.stringify(t)}var r}function getApplicationInfo(e){return{google_app_id:getAppId(e),app_instance_id:getIid(),web_app_info:{sdk_version:"0.6.4",page_url:Api.getInstance().getUrl(),service_worker_status:getServiceWorkerStatus(),visibility_state:getVisibilityState(),effective_connection_type:getEffectiveConnectionType()},application_process_state:0}}const V=["_fp","_fcp","_fid"];class Trace{constructor(e,t,r=!1,n){this.performanceController=e,this.name=t,this.isAuto=r,this.state=1,this.customAttributes={},this.counters={},this.api=Api.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark=`FB-PERF-TRACE-START-${this.randomId}-`+this.name,this.traceStopMark=`FB-PERF-TRACE-STOP-${this.randomId}-`+this.name,this.traceMeasure=n||`FB-PERF-TRACE-MEASURE-${this.randomId}-`+this.name,n&&this.calculateTraceMetrics())}start(){if(1!==this.state)throw k.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(2!==this.state)throw k.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),logTrace(this)}record(e,t,r){if(e<=0)throw k.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw k.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),r&&r.attributes&&(this.customAttributes=Object.assign({},r.attributes)),r&&r.metrics)for(const e of Object.keys(r.metrics))isNaN(Number(r.metrics[e]))||(this.counters[e]=Math.floor(Number(r.metrics[e])));logTrace(this)}incrementMetric(e,t=1){void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(n=e,r=this.name,0===n.length||100<n.length||!(r&&r.startsWith("_wt_")&&-1<V.indexOf(n))&&n.startsWith("_"))throw k.create("invalid custom metric name",{customMetricName:e});var r,n;this.counters[e]=(r=null!=t?t:0,(n=Math.floor(r))<r&&R.info(`Metric value should be an Integer, setting the value as : ${n}.`),n)}getMetric(e){return this.counters[e]||0}putAttribute(e,t){var r,n=!(0===(r=e).length||40<r.length||D.some(e=>r.startsWith(e))||!r.match(L)),i=0!==(i=t).length&&i.length<=100;if(n&&i)this.customAttributes[e]=t;else{if(!n)throw k.create("invalid attribute name",{attributeName:e});if(!i)throw k.create("invalid attribute value",{attributeValue:t})}}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){var e=this.api.getEntriesByName(this.traceMeasure),e=e&&e[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))}static createOobTrace(e,t,r,n){var i=Api.getInstance().getUrl();if(i){const a=new Trace(e,"_wt_"+i,!0),o=Math.floor(1e3*Api.getInstance().getTimeOrigin());if(a.setStartTime(o),t&&t[0]&&(a.setDuration(Math.floor(1e3*t[0].duration)),a.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),a.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),a.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),r){const e=r.find(e=>"first-paint"===e.name),t=(e&&e.startTime&&a.putMetric("_fp",Math.floor(1e3*e.startTime)),r.find(e=>"first-contentful-paint"===e.name));t&&t.startTime&&a.putMetric("_fcp",Math.floor(1e3*t.startTime)),n&&a.putMetric("_fid",Math.floor(1e3*n))}logTrace(a)}}static createUserTimingTrace(e,t){logTrace(new Trace(e,t,!1,t))}}function createNetworkRequestEntry(e,t){const r=t;if(r&&void 0!==r.responseStart){var t=Api.getInstance().getTimeOrigin(),t=Math.floor(1e3*(r.startTime+t)),n=r.responseStart?Math.floor(1e3*(r.responseStart-r.startTime)):void 0,i=Math.floor(1e3*(r.responseEnd-r.startTime));{var a={performanceController:e,url:r.name&&r.name.split("?")[0],responsePayloadBytes:r.transferSize,startTimeUs:t,timeToResponseInitiatedUs:n,timeToResponseCompletedUs:i};const o=SettingsService.getInstance();o.instrumentationEnabled&&(e=a.url,t=o.logEndPointUrl.split("?")[0],n=o.flTransportEndpointUrl.split("?")[0],e!==t&&e!==n&&o.loggingEnabled&&o.logNetworkAfterSampling&&setTimeout(()=>sendLog(a,0),0))}}}function setupOobResources(a){getIid()&&(setTimeout(()=>{{var r=a;const e=Api.getInstance(),n=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let t=setTimeout(()=>{Trace.createOobTrace(r,n,i),t=void 0},5e3);e.onFirstInputDelay(e=>{t&&(clearTimeout(t),Trace.createOobTrace(r,n,i,e))})}else Trace.createOobTrace(r,n,i);return}},0),setTimeout(()=>{{var t=a;const e=Api.getInstance(),r=e.getEntriesByType("resource");for(const e of r)createNetworkRequestEntry(t,e);return void e.setupObserver("resource",e=>createNetworkRequestEntry(t,e))}},0),setTimeout(()=>{{var t=a;const e=Api.getInstance(),r=e.getEntriesByType("measure");for(const e of r)createUserTimingTrace(t,e);return void e.setupObserver("measure",e=>createUserTimingTrace(t,e))}},0))}function createUserTimingTrace(e,t){const r=t.name;"FB-PERF-TRACE-MEASURE"!==r.substring(0,"FB-PERF-TRACE-MEASURE".length)&&Trace.createUserTimingTrace(e,r)}class PerformanceController{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||(void 0!==(null==e?void 0:e.dataCollectionEnabled)&&(this.dataCollectionEnabled=e.dataCollectionEnabled),void 0!==(null==e?void 0:e.instrumentationEnabled)&&(this.instrumentationEnabled=e.instrumentationEnabled),Api.getInstance().requiredApisAvailable()?new Promise((t,r)=>{try{let e=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(n),t(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{var e;r((null==(e=i.error)?void 0:e.message)||"")}}catch(t){r(t)}}).then(e=>{e&&(H||(processQueue(5500),H=!0),getInitializationPromise(this).then(()=>setupOobResources(this),()=>setupOobResources(this)),this.initialized=!0)}).catch(e=>{R.info("Environment doesn't support IndexedDB: "+e)}):R.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){SettingsService.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return SettingsService.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){SettingsService.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return SettingsService.getInstance().dataCollectionEnabled}}function getPerformance(e=n()){return e=getModularInstance(e),_getProvider(e,"performance").getImmediate()}function initializePerformance(e,t){e=getModularInstance(e);const r=_getProvider(e,"performance");if(r.isInitialized()){const e=r.getImmediate();if(deepEqual(r.getOptions(),null!=t?t:{}))return e;throw k.create("already initialized")}return r.initialize({options:t})}function trace(e,t){return e=getModularInstance(e),new Trace(e,t)}const factory=(e,{options:t})=>{var r,n=e.getProvider("app").getImmediate(),e=e.getProvider("installations-internal").getImmediate();if("[DEFAULT]"!==n.name)throw k.create("FB not default");if("undefined"==typeof window)throw k.create("no window");r=window,N=r;const i=new PerformanceController(n,e);return i._init(t),i};t(new Component("performance",factory,"PUBLIC")),e(A,"0.6.4"),e(A,"0.6.4","esm2017");export{getPerformance,initializePerformance,trace};