!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase,t.firebase.INTERNAL.modularAPIs)}(this,function(lt,gt){"use strict";try{!function(){var r,t=(t=lt)&&"object"==typeof t&&"default"in t?t:{default:t};class a extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,a.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,i.prototype.create)}}class i{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){var r,e=e[0]||{},n=this.service+"/"+t,t=(t=this.errors[t])?(r=e,t.replace(M,(t,e)=>{var n=r[e];return null!=n?String(n):`<${e}?>`})):"Error",t=this.serviceName+`: ${t} (${n}).`;return new a(n,t,e)}}const M=/\{\$([^}]+)}/g;class e{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const x=(e,t)=>t.some(t=>e instanceof t);let o,s;const c=new WeakMap,u=new WeakMap,p=new WeakMap,f=new WeakMap,d=new WeakMap;let l={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return u.get(t);if("objectStoreNames"===e)return t.objectStoreNames||p.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return g(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function V(t){return"function"==typeof t?(n=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(s=s||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(n)?function(...t){return n.apply(h(this),t),g(c.get(this))}:function(...t){return g(n.apply(h(this),t))}:function(t,...e){e=n.call(h(this),t,...e);return p.set(e,t.sort?t.sort():[t]),g(e)}:(t instanceof IDBTransaction&&(i=t,u.has(i)||(e=new Promise((t,e)=>{const n=()=>{i.removeEventListener("complete",r),i.removeEventListener("error",a),i.removeEventListener("abort",a)},r=()=>{t(),n()},a=()=>{e(i.error||new DOMException("AbortError","AbortError")),n()};i.addEventListener("complete",r),i.addEventListener("error",a),i.addEventListener("abort",a)}),u.set(i,e))),x(t,o=o||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])?new Proxy(t,l):t);var n,i,e}function g(t){if(t instanceof IDBRequest){var i=t;const n=new Promise((t,e)=>{const n=()=>{i.removeEventListener("success",r),i.removeEventListener("error",a)},r=()=>{t(g(i.result)),n()},a=()=>{e(i.error),n()};i.addEventListener("success",r),i.addEventListener("error",a)});return n.then(t=>{t instanceof IDBCursor&&c.set(t,i)}).catch(()=>{}),d.set(n,i),n}if(f.has(t))return f.get(t);var e=V(t);return e!==t&&(f.set(t,e),d.set(e,t)),e}const h=t=>d.get(t),$=["get","getKey","getAll","getAllKeys","count"],_=["put","add","delete","clear"],n=new Map;function w(t,e){if(t instanceof IDBDatabase&&!(e in t)&&"string"==typeof e){if(n.get(e))return n.get(e);const r=e.replace(/FromIndex$/,""),a=e!==r,i=_.includes(r);return r in(a?IDBIndex:IDBObjectStore).prototype&&(i||$.includes(r))?(t=async function(t,...e){t=this.transaction(t,i?"readwrite":"readonly");let n=t.store;return a&&(n=n.index(e.shift())),(await Promise.all([n[r](...e),i&&t.done]))[0]},n.set(e,t),t):void 0}}l={...r=l,get:(t,e,n)=>w(t,e)||r.get(t,e,n),has:(t,e)=>!!w(t,e)||r.has(t,e)};var v="@firebase/installations",m="0.6.4";const y=1e4,F="w:"+m,K="FIS_v2",H="https://firebaseinstallations.googleapis.com/v1",R=36e5,b=new i("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function W(t){return t instanceof a&&t.code.includes("request-failed")}function I({projectId:t}){return H+`/projects/${t}/installations`}function z(t){return{token:t.token,requestStatus:2,expiresIn:(t=t.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()}}async function S(t,e){e=(await e.json()).error;return b.create("request-failed",{requestName:t,serverCode:e.code,serverMessage:e.message,serverStatus:e.status})}function U({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function J(t,{refreshToken:e}){const n=U(t);return n.append("Authorization",K+" "+e),n}async function C(t){var e=await t();return 500<=e.status&&e.status<600?t():e}function G(e){return new Promise(t=>{setTimeout(t,e)})}const Y=/^[cdef][\w-]{21}$/,T="";function k(t){return t.appName+"!"+t.appId}const E=new Map;function Z(t,e){t=k(t);Q(t,e);{const n=X();return n&&n.postMessage({key:t,fid:e}),void tt()}}function Q(t,e){t=E.get(t);if(t)for(const n of t)n(e)}let j=null;function X(){return!j&&"BroadcastChannel"in self&&((j=new BroadcastChannel("[Firebase] FID Change")).onmessage=t=>{Q(t.data.key,t.data.fid)}),j}function tt(){0===E.size&&j&&(j.close(),j=null)}const et="firebase-installations-database",nt=1,D="firebase-installations-store";let rt=null;function P(){return rt=rt||function(t,e,{blocked:n,upgrade:r,blocking:a,terminated:i}){const o=indexedDB.open(t,e),s=g(o);return r&&o.addEventListener("upgradeneeded",t=>{r(g(o.result),t.oldVersion,t.newVersion,g(o.transaction),t)}),n&&o.addEventListener("blocked",t=>n(t.oldVersion,t.newVersion,t)),s.then(t=>{i&&t.addEventListener("close",()=>i()),a&&t.addEventListener("versionchange",t=>a(t.oldVersion,t.newVersion,t))}).catch(()=>{}),s}(et,nt,{upgrade:(t,e)=>{0===e&&t.createObjectStore(D)}})}async function B(t,e){var n=k(t);const r=await P(),a=r.transaction(D,"readwrite"),i=a.objectStore(D);var o=await i.get(n);return await i.put(e,n),await a.done,o&&o.fid===e.fid||Z(t,e.fid),e}async function L(t){t=k(t);const e=await P(),n=e.transaction(D,"readwrite");await n.objectStore(D).delete(t),await n.done}async function q(t,e){var n=k(t);const r=await P(),a=r.transaction(D,"readwrite"),i=a.objectStore(D);var o=await i.get(n),e=e(o);return void 0===e?await i.delete(n):await i.put(e,n),await a.done,!e||o&&o.fid===e.fid||Z(t,e.fid),e}async function N(e){let n;var t=await q(e.appConfig,t=>{t=it(t||{fid:function(){try{const e=new Uint8Array(17),n=self.crypto||self.msCrypto;n.getRandomValues(e),e[0]=112+e[0]%16;var t=function(e){const t=function(){const t=btoa(String.fromCharCode(...e));return t.replace(/\+/g,"-").replace(/\//g,"_")}();return t.substr(0,22)}(e);return Y.test(t)?t:T}catch(t){return T}}(),registrationStatus:0}),t=function(t,e){if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:async function(t){let e=await at(t.appConfig);for(;1===e.registrationStatus;)await G(100),e=await at(t.appConfig);if(0!==e.registrationStatus)return e;var{installationEntry:n,registrationPromise:r}=await N(t);return r||n}(t)}:{installationEntry:e};if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(b.create("app-offline"))};e={fid:e.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:e,registrationPromise:async function(t,e){try{var n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=I(t),a=U(t),i=e.getImmediate({optional:!0});i&&(o=await i.getHeartbeatsHeader())&&a.append("x-firebase-client",o);var o={fid:n,authVersion:K,appId:t.appId,sdkVersion:F};const s={method:"POST",headers:a,body:JSON.stringify(o)},c=await C(()=>fetch(r,s));if(c.ok)return{fid:(o=await c.json()).fid||n,registrationStatus:2,refreshToken:o.refreshToken,authToken:z(o.authToken)};throw await S("Create Installation",c)}(t,e);return B(t.appConfig,n)}catch(n){throw W(n)&&409===n.customData.serverCode?await L(t.appConfig):await B(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,e)}}(e,t);return n=t.registrationPromise,t.installationEntry});return t.fid===T?{installationEntry:await n}:{installationEntry:t,registrationPromise:n}}function at(t){return q(t,t=>{if(t)return it(t);throw b.create("installation-not-found")})}function it(t){return 1===t.registrationStatus&&t.registrationTime+y<Date.now()?{fid:t.fid,registrationStatus:0}:t}async function O(i,o=!1){let s;var t=await q(i.appConfig,t=>{if(!st(t))throw b.create("not-registered");var e,n,r,a=t.authToken;if(o||2!==(e=a).requestStatus||(n=e,(r=Date.now())<n.creationTime||n.creationTime+n.expiresIn<r+R)){if(1===a.requestStatus)return s=async function(t,e){let n=await ot(t.appConfig);for(;1===n.authToken.requestStatus;)await G(100),n=await ot(t.appConfig);var r=n.authToken;return 0===r.requestStatus?O(t,e):r}(i,o),t;if(navigator.onLine)return e=t,a={requestStatus:1,requestTime:Date.now()},a=Object.assign(Object.assign({},e),{authToken:a}),s=async function(t,e){try{var n=await async function({appConfig:t,heartbeatServiceProvider:e},n){[a,i]=[t,n.fid];const r=I(a)+`/${i}/authTokens:generate`;var a,i;const o=J(t,n),s=e.getImmediate({optional:!0});s&&(c=await s.getHeartbeatsHeader())&&o.append("x-firebase-client",c);var c={installation:{sdkVersion:F,appId:t.appId}};const u={method:"POST",headers:o,body:JSON.stringify(c)},p=await C(()=>fetch(r,u));if(p.ok)return z(await p.json());throw await S("Generate Auth Token",p)}(t,e),r=Object.assign(Object.assign({},e),{authToken:n});return await B(t.appConfig,r),n}catch(r){throw!W(r)||401!==r.customData.serverCode&&404!==r.customData.serverCode?(n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}),await B(t.appConfig,n)):await L(t.appConfig),r}}(i,a),a;throw b.create("app-offline")}return t});return s?await s:t.authToken}function ot(t){return q(t,t=>{if(!st(t))throw b.create("not-registered");var e=t.authToken;return 1===e.requestStatus&&e.requestTime+y<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t})}function st(t){return void 0!==t&&2===t.registrationStatus}async function ct(t){const{installationEntry:e,registrationPromise:n}=await N(t);return(n||O(t)).catch(console.error),e.fid}async function ut(t,e=!1){var n;return await((n=(await N(t)).registrationPromise)&&await n),(await O(t,e)).token}function pt(e,r){const a=e.appConfig;{e=a;var n=r;X(),e=k(e);let t=E.get(e);t||(t=new Set,E.set(e,t)),t.add(n)}return()=>{{var t=a,e=r;t=k(t);const n=E.get(t);return void(n&&(n.delete(e),0===n.size&&E.delete(t),tt()))}}}function A(t){return b.create("missing-app-config-values",{valueName:t})}const ft="installations";gt._registerComponent(new e(ft,t=>{t=t.getProvider("app").getImmediate();return{app:t,appConfig:function(t){if(!t||!t.options)throw A("App Configuration");if(!t.name)throw A("App Name");for(const e of["projectId","apiKey","appId"])if(!t.options[e])throw A(e);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(t),heartbeatServiceProvider:gt._getProvider(t,"heartbeat"),_delete:()=>Promise.resolve()}},"PUBLIC")),gt._registerComponent(new e("installations-internal",t=>{t=t.getProvider("app").getImmediate();const e=gt._getProvider(t,ft).getImmediate();return{getId:()=>ct(e),getToken:t=>ut(e,t)}},"PRIVATE")),gt.registerVersion(v,m),gt.registerVersion(v,m,"esm2017");class dt{constructor(t,e){this.app=t,this._delegate=e}getId(){return ct(this._delegate)}getToken(t){return ut(this._delegate,t)}delete(){return async function(t){var e,t=t.appConfig,n=await q(t,t=>{if(!t||0!==t.registrationStatus)return t});if(n){if(1===n.registrationStatus)throw b.create("delete-pending-registration");if(2===n.registrationStatus){if(!navigator.onLine)throw b.create("app-offline");{var r=t;[a,e]=[r,n.fid];const i=I(a)+"/"+e;const o={method:"DELETE",headers:J(r,n)};var a=await C(()=>fetch(i,o));if(!a.ok)throw await S("Delete Installation",a)}await 0,await L(t)}}}(this._delegate)}onIdChange(t){return pt(this._delegate,t)}}(v=t.default).INTERNAL.registerComponent(new e("installations-compat",t=>{var e=t.getProvider("app-compat").getImmediate(),t=t.getProvider("installations").getImmediate();return new dt(e,t)},"PUBLIC")),v.registerVersion("@firebase/installations-compat","0.2.4")}.apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-installations-compat.js - be sure to load firebase-app.js first.")}});