import{_registerComponent as e,registerVersion as t,_getProvider,getApp as r,_removeServiceInstance as n,SDK_VERSION as i}from"https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";const stringToByteArray$1=function(r){const n=[];let i=0;for(let t=0;t<r.length;t++){let e=r.charCodeAt(t);e<128?n[i++]=e:(e<2048?n[i++]=e>>6|192:(55296==(64512&e)&&t+1<r.length&&56320==(64512&r.charCodeAt(t+1))?(e=65536+((1023&e)<<10)+(1023&r.charCodeAt(++t)),n[i++]=e>>18|240,n[i++]=e>>12&63|128):n[i++]=e>>12|224,n[i++]=e>>6&63|128),n[i++]=63&e|128)}return n},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let r=0;r<n.length;r+=3){var a=n[r],o=r+1<n.length,l=o?n[r+1]:0,u=r+2<n.length,c=u?n[r+2]:0;let e=(15&l)<<2|c>>6,t=63&c;u||(t=64,o||(e=64)),s.push(i[a>>2],i[(3&a)<<4|l>>4],i[e],i[t])}return s.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(stringToByteArray$1(e),t)},decodeString(r,n){if(this.HAS_NATIVE_SUPPORT&&!n)return atob(r);{var i=this.decodeStringToByteArray(r,n);const u=[];let e=0,t=0;for(;e<i.length;){var s,a,o,l=i[e++];l<128?u[t++]=String.fromCharCode(l):191<l&&l<224?(s=i[e++],u[t++]=String.fromCharCode((31&l)<<6|63&s)):239<l&&l<365?(s=((7&l)<<18|(63&i[e++])<<12|(63&i[e++])<<6|63&i[e++])-65536,u[t++]=String.fromCharCode(55296+(s>>10)),u[t++]=String.fromCharCode(56320+(1023&s))):(a=i[e++],o=i[e++],u[t++]=String.fromCharCode((15&l)<<12|(63&a)<<6|63&o))}return u.join("")}},decodeStringToByteArray(t,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let e=0;e<t.length;){var i=r[t.charAt(e++)],s=e<t.length?r[t.charAt(e)]:0,a=++e<t.length?r[t.charAt(e)]:64,o=++e<t.length?r[t.charAt(e)]:64;if(++e,null==i||null==s||null==a||null==o)throw new DecodeBase64StringError;if(n.push(i<<2|s>>4),64!==a){const t=s<<4&240|a>>2;if(n.push(t),64!==o){const t=a<<6&192|o;n.push(t)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class DecodeBase64StringError extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const base64urlEncodeWithoutPadding=function(e){return function(e){e=stringToByteArray$1(e);return s.encodeByteArray(e,!0)}(e).replace(/\./g,"")},getDefaultsFromGlobal=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,getDefaultsFromCookie=()=>{if("undefined"!=typeof document){let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}var t=e&&function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(e[1]);return t&&JSON.parse(t)}},getDefaults=()=>{try{return getDefaultsFromGlobal()||(()=>{var e;if("undefined"!=typeof process&&void 0!==process.env)return e=process.env.__FIREBASE_DEFAULTS__,e?JSON.parse(e):void 0})()||getDefaultsFromCookie()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: "+e)}},getDefaultEmulatorHostnameAndPort=e=>{e=e;const t=null==(r=null==(r=getDefaults())?void 0:r.emulatorHosts)?void 0:r[e];if(t){var r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);e=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),e]:[t.substring(0,r),e]}};class FirebaseError extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var n,t=t[0]||{},r=this.service+"/"+e,e=this.errors[e],e=e?(n=t,e.replace(o,(e,t)=>{var r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",e=this.serviceName+`: ${e} (${r}).`;return new FirebaseError(r,e,t)}}const o=/\{\$([^}]+)}/g;function deepEqual(e,t){if(e===t)return!0;const r=Object.keys(e),n=Object.keys(t);for(const i of r){if(!n.includes(i))return!1;const r=e[i],s=t[i];if(isObject(r)&&isObject(s)){if(!deepEqual(r,s))return!1}else if(r!==s)return!1}for(const e of n)if(!r.includes(e))return!1;return!0}function isObject(e){return null!==e&&"object"==typeof e}function getModularInstance(e){return e&&e._delegate?e._delegate:e}class Component{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}var a,b,D;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(a=a||{});const u={debug:a.DEBUG,verbose:a.VERBOSE,info:a.INFO,warn:a.WARN,error:a.ERROR,silent:a.SILENT},l=a.INFO,c={[a.DEBUG]:"log",[a.VERBOSE]:"log",[a.INFO]:"info",[a.WARN]:"warn",[a.ERROR]:"error"},defaultLogHandler=(e,t,...r)=>{if(!(t<e.logLevel)){var n=(new Date).toISOString(),i=c[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${n}]  ${e.name}:`,...r)}};class User{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}User.UNAUTHENTICATED=new User(null),User.GOOGLE_CREDENTIALS=new User("google-credentials-uid"),User.FIRST_PARTY=new User("first-party-uid"),User.MOCK_USER=new User("mock-user");let _="10.6.0";const h=new class{constructor(e){this.name=e,this._logLevel=l,this._logHandler=defaultLogHandler,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in a))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?u[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,a.DEBUG,...e),this._logHandler(this,a.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,a.VERBOSE,...e),this._logHandler(this,a.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,a.INFO,...e),this._logHandler(this,a.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,a.WARN,...e),this._logHandler(this,a.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,a.ERROR,...e),this._logHandler(this,a.ERROR,...e)}}("@firebase/firestore");function setLogLevel(e){h.setLogLevel(e)}function __PRIVATE_logDebug(e,...t){h.logLevel<=a.DEBUG&&(t=t.map(__PRIVATE_argToString),h.debug(`Firestore (${_}): `+e,...t))}function __PRIVATE_logError(e,...t){h.logLevel<=a.ERROR&&(t=t.map(__PRIVATE_argToString),h.error(`Firestore (${_}): `+e,...t))}function __PRIVATE_logWarn(e,...t){h.logLevel<=a.WARN&&(t=t.map(__PRIVATE_argToString),h.warn(`Firestore (${_}): `+e,...t))}function __PRIVATE_argToString(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function fail(e="Unexpected state"){e=`FIRESTORE (${_}) INTERNAL ASSERTION FAILED: `+e;throw __PRIVATE_logError(e),new Error(e)}function __PRIVATE_hardAssert(e,t){e||fail()}function __PRIVATE_debugCast(e,t){return e}const d="cancelled",f="unknown",m="invalid-argument",p="deadline-exceeded",g="not-found",E="permission-denied",T="unauthenticated",y="resource-exhausted",A="failed-precondition",I="aborted",P="out-of-range",R="unimplemented",V="internal",v="unavailable";class FirestoreError extends FirebaseError{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: `+this.message}}class __PRIVATE_Deferred{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class __PRIVATE_OAuthToken{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer "+e)}}class __PRIVATE_EmptyAuthCredentialsProvider{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(User.UNAUTHENTICATED))}shutdown(){}}class __PRIVATE_EmulatorAuthCredentialsProvider{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class __PRIVATE_LiteAuthCredentialsProvider{constructor(e){this.auth=null,e.onInit(e=>{this.auth=e})}getToken(){return this.auth?this.auth.getToken().then(e=>e?(__PRIVATE_hardAssert("string"==typeof e.accessToken),new __PRIVATE_OAuthToken(e.accessToken,new User(this.auth.getUid()))):null):Promise.resolve(null)}invalidateToken(){}start(e,t){}shutdown(){}}class __PRIVATE_FirstPartyToken{constructor(e,t,r){this.t=e,this.i=t,this.o=r,this.type="FirstParty",this.user=User.FIRST_PARTY,this.u=new Map}l(){return this.o?this.o():null}get headers(){this.u.set("X-Goog-AuthUser",this.t);var e=this.l();return e&&this.u.set("Authorization",e),this.i&&this.u.set("X-Goog-Iam-Authorization-Token",this.i),this.u}}class __PRIVATE_FirstPartyAuthCredentialsProvider{constructor(e,t,r){this.t=e,this.i=t,this.o=r}getToken(){return Promise.resolve(new __PRIVATE_FirstPartyToken(this.t,this.i,this.o))}start(e,t){e.enqueueRetryable(()=>t(User.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class AppCheckToken{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class __PRIVATE_LiteAppCheckTokenProvider{constructor(e){this.h=e,this.appCheck=null,e.onInit(e=>{this.appCheck=e})}getToken(){return this.appCheck?this.appCheck.getToken().then(e=>e?(__PRIVATE_hardAssert("string"==typeof e.token),new AppCheckToken(e.token)):null):Promise.resolve(null)}invalidateToken(){}start(e,t){}shutdown(){}}class DatabaseInfo{constructor(e,t,r,n,i,s,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}class DatabaseId{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new DatabaseId("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof DatabaseId&&e.projectId===this.projectId&&e.database===this.database}}class BasePath{constructor(e,t,r){void 0===t?t=0:t>e.length&&fail(),void 0===r?r=e.length-t:r>e.length-t&&fail(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===BasePath.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof BasePath?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(r){for(let e=this.offset,t=this.limit();e<t;e++)r(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,r){const n=Math.min(t.length,r.length);for(let e=0;e<n;e++){const n=t.get(e),i=r.get(e);if(n<i)return-1;if(n>i)return 1}return t.length<r.length?-1:t.length>r.length?1:0}}class ResourcePath extends BasePath{construct(e,t,r){return new ResourcePath(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(0<=r.indexOf("//"))throw new FirestoreError(m,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>0<e.length))}return new ResourcePath(t)}static emptyPath(){return new ResourcePath([])}}const w=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class FieldPath$1 extends BasePath{construct(e,t,r){return new FieldPath$1(e,t,r)}static isValidIdentifier(e){return w.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=FieldPath$1.isValidIdentifier(e)?e:"`"+e+"`")).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new FieldPath$1(["__name__"])}static fromServerFormat(e){const t=[];let r="",n=0;var i=()=>{if(0===r.length)throw new FirestoreError(m,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let s=!1;for(;n<e.length;){const t=e[n];if("\\"===t){if(n+1===e.length)throw new FirestoreError(m,"Path has trailing escape character: "+e);const t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new FirestoreError(m,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new FirestoreError(m,"Unterminated ` in path: "+e);return new FieldPath$1(t)}static emptyPath(){return new FieldPath$1([])}}class DocumentKey{constructor(e){this.path=e}static fromPath(e){return new DocumentKey(ResourcePath.fromString(e))}static fromName(e){return new DocumentKey(ResourcePath.fromString(e).popFirst(5))}static empty(){return new DocumentKey(ResourcePath.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ResourcePath.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ResourcePath.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new DocumentKey(new ResourcePath(e.slice()))}}function __PRIVATE_validateNonEmptyArgument(e,t,r){if(!r)throw new FirestoreError(m,`Function ${e}() cannot be called with an empty ${t}.`)}function __PRIVATE_validateDocumentPath(e){if(!DocumentKey.isDocumentKey(e))throw new FirestoreError(m,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function __PRIVATE_validateCollectionPath(e){if(DocumentKey.isDocumentKey(e))throw new FirestoreError(m,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function __PRIVATE_valueDescription(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":fail();if(e instanceof Array)return"an array";e=(e=e).constructor?e.constructor.name:null;return e?`a custom ${e} object`:"an object"}function __PRIVATE_cast(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new FirestoreError(m,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");e=__PRIVATE_valueDescription(e);throw new FirestoreError(m,`Expected type '${t.name}', but it was: `+e)}function __PRIVATE_validatePositiveNumber(e,t){if(t<=0)throw new FirestoreError(m,`Function ${e}() requires a positive number, but it was: ${t}.`)}function __PRIVATE_cloneLongPollingOptions(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let F=null;function __PRIVATE_isNullOrUndefined(e){return null==e}function __PRIVATE_isNegativeZero(e){return 0===e&&1/e==-1/0}const S={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};function __PRIVATE_mapCodeFromHttpStatus(e){if(void 0===e)return __PRIVATE_logError("RPC_ERROR","HTTP error has no status"),f;switch(e){case 200:return"ok";case 400:return A;case 401:return T;case 403:return E;case 404:return g;case 409:return I;case 416:return P;case 429:return y;case 499:return d;case 500:return f;case 501:return R;case 503:return v;case 504:return p;default:return 200<=e&&e<300?"ok":400<=e&&e<500?A:500<=e&&e<600?V:f}}(D=b=b||{})[D.OK=0]="OK",D[D.CANCELLED=1]="CANCELLED",D[D.UNKNOWN=2]="UNKNOWN",D[D.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",D[D.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",D[D.NOT_FOUND=5]="NOT_FOUND",D[D.ALREADY_EXISTS=6]="ALREADY_EXISTS",D[D.PERMISSION_DENIED=7]="PERMISSION_DENIED",D[D.UNAUTHENTICATED=16]="UNAUTHENTICATED",D[D.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",D[D.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",D[D.ABORTED=10]="ABORTED",D[D.OUT_OF_RANGE=11]="OUT_OF_RANGE",D[D.UNIMPLEMENTED=12]="UNIMPLEMENTED",D[D.INTERNAL=13]="INTERNAL",D[D.UNAVAILABLE=14]="UNAVAILABLE",D[D.DATA_LOSS=15]="DATA_LOSS";class __PRIVATE_FetchConnection extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.m=t+"://"+e.host,this.A=`projects/${r}/databases/`+n,this.T="(default)"===this.databaseId.database?"project_id="+r:`project_id=${r}&database_id=`+n}get P(){return!1}R(t,e,r,n,i){null===F?F=268435456+Math.round(2147483648*Math.random()):F++;const s="0x"+F.toString(16),a=this.I(t,e);__PRIVATE_logDebug("RestConnection",`Sending RPC '${t}' ${s}:`,a,r);e={"google-cloud-resource-prefix":this.A,"x-goog-request-params":this.T};return this.V(e,n,i),this.p(t,a,e,r).then(e=>(__PRIVATE_logDebug("RestConnection",`Received RPC '${t}' ${s}: `,e),e),e=>{throw __PRIVATE_logWarn("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",a,"request:",r),e})}g(e,t,r,n,i,s){return this.R(e,t,r,n,i)}V(r,e,t){r["X-Goog-Api-Client"]="gl-js/ fire/"+_,r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>r[t]=e),t&&t.headers.forEach((e,t)=>r[t]=e)}I(e,t){e=S[e];return this.m+`/v1/${t}:`+e}}{constructor(e,t){super(e),this.F=t}v(e,t){throw new Error("Not supported by FetchConnection")}async p(e,t,r,n){n=JSON.stringify(n);let i;try{i=await this.F(t,{method:"POST",headers:r,body:n})}catch(e){const t=e;throw new FirestoreError(__PRIVATE_mapCodeFromHttpStatus(t.status),"Request failed with error: "+t.statusText)}if(i.ok)return i.json();{let e=await i.json();const t=null==(r=null==(e=Array.isArray(e)?e[0]:e)?void 0:e.error)?void 0:r.message;throw new FirestoreError(__PRIVATE_mapCodeFromHttpStatus(i.status),"Request failed with error: "+(null!=t?t:i.statusText))}}}class __PRIVATE_AggregateImpl{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}function __PRIVATE_randomBytes(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(r);else for(let e=0;e<t;e++)r[e]=Math.floor(256*Math.random());return r}class __PRIVATE_AutoId{static newId(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){var i=__PRIVATE_randomBytes(40);for(let e=0;e<i.length;++e)n.length<20&&i[e]<r&&(n+=t.charAt(i[e]%t.length))}return n}}function __PRIVATE_primitiveComparator(e,t){return e<t?-1:t<e?1:0}function __PRIVATE_arrayEquals(e,r,n){return e.length===r.length&&e.every((e,t)=>n(e,r[t]))}function __PRIVATE_objectSize(e){let t=0;for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function forEach(e,t){for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}class __PRIVATE_Base64DecodeError extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ByteString{constructor(e){this.binaryString=e}static fromBase64String(e){e=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new __PRIVATE_Base64DecodeError("Invalid base64 string: "+e):e}}(e);return new ByteString(e)}static fromUint8Array(e){e=function(t){let r="";for(let e=0;e<t.length;++e)r+=String.fromCharCode(t[e]);return r}(e);return new ByteString(e)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){{var t=this.binaryString;const r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return __PRIVATE_primitiveComparator(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ByteString.EMPTY_BYTE_STRING=new ByteString("");const C=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function __PRIVATE_normalizeTimestamp(t){if(__PRIVATE_hardAssert(!!t),"string"!=typeof t)return{seconds:__PRIVATE_normalizeNumber(t.seconds),nanos:__PRIVATE_normalizeNumber(t.nanos)};{let e=0;var r=C.exec(t);__PRIVATE_hardAssert(!!r),r[1]&&(r=((r=r[1])+"000000000").substr(0,9),e=Number(r));const n=new Date(t);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}}function __PRIVATE_normalizeNumber(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function __PRIVATE_normalizeByteString(e){return"string"==typeof e?ByteString.fromBase64String(e):ByteString.fromUint8Array(e)}class Timestamp{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new FirestoreError(m,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new FirestoreError(m,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new FirestoreError(m,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new FirestoreError(m,"Timestamp seconds out of range: "+e)}static now(){return Timestamp.fromMillis(Date.now())}static fromDate(e){return Timestamp.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),e=Math.floor(1e6*(e-1e3*t));return new Timestamp(t,e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?__PRIVATE_primitiveComparator(this.nanoseconds,e.nanoseconds):__PRIVATE_primitiveComparator(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}function __PRIVATE_isServerTimestamp(e){return"server_timestamp"===(null==(e=((null==(e=null==e?void 0:e.mapValue)?void 0:e.fields)||{}).__type__)?void 0:e.stringValue)}function __PRIVATE_getPreviousValue(e){e=e.mapValue.fields.__previous_value__;return __PRIVATE_isServerTimestamp(e)?__PRIVATE_getPreviousValue(e):e}function __PRIVATE_getLocalWriteTime(e){e=__PRIVATE_normalizeTimestamp(e.mapValue.fields.__local_write_time__.timestampValue);return new Timestamp(e.seconds,e.nanos)}const N={fields:{__type__:{stringValue:"__max__"}}};function __PRIVATE_typeOrder(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?__PRIVATE_isServerTimestamp(e)?4:"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue?9007199254740991:10:fail()}function __PRIVATE_valueEquals(e,t){if(e===t)return!0;var r,n=__PRIVATE_typeOrder(e);if(n!==__PRIVATE_typeOrder(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return __PRIVATE_getLocalWriteTime(e).isEqual(__PRIVATE_getLocalWriteTime(t));case 3:var i=e,s=t;return"string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length?i.timestampValue===s.timestampValue:(i=__PRIVATE_normalizeTimestamp(i.timestampValue),s=__PRIVATE_normalizeTimestamp(s.timestampValue),i.seconds===s.seconds&&i.nanos===s.nanos);case 5:return e.stringValue===t.stringValue;case 6:return i=t,__PRIVATE_normalizeByteString(e.bytesValue).isEqual(__PRIVATE_normalizeByteString(i.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return s=t,__PRIVATE_normalizeNumber((r=e).geoPointValue.latitude)===__PRIVATE_normalizeNumber(s.geoPointValue.latitude)&&__PRIVATE_normalizeNumber(r.geoPointValue.longitude)===__PRIVATE_normalizeNumber(s.geoPointValue.longitude);case 2:return r=t,"integerValue"in(o=e)&&"integerValue"in r?__PRIVATE_normalizeNumber(o.integerValue)===__PRIVATE_normalizeNumber(r.integerValue):"doubleValue"in o&&"doubleValue"in r&&((o=__PRIVATE_normalizeNumber(o.doubleValue))===(r=__PRIVATE_normalizeNumber(r.doubleValue))?__PRIVATE_isNegativeZero(o)===__PRIVATE_isNegativeZero(r):isNaN(o)&&isNaN(r));case 9:return __PRIVATE_arrayEquals(e.arrayValue.values||[],t.arrayValue.values||[],__PRIVATE_valueEquals);case 10:{var a=e;var o=t;const l=a.mapValue.fields||{},u=o.mapValue.fields||{};if(__PRIVATE_objectSize(l)!==__PRIVATE_objectSize(u))return!1;for(const a in l)if(l.hasOwnProperty(a)&&(void 0===u[a]||!__PRIVATE_valueEquals(l[a],u[a])))return!1;return!0;return}default:return fail()}}function __PRIVATE_arrayValueContains(e,t){return void 0!==(e.values||[]).find(e=>__PRIVATE_valueEquals(e,t))}function __PRIVATE_valueCompare(e,t){if(e===t)return 0;var r=__PRIVATE_typeOrder(e),n=__PRIVATE_typeOrder(t);if(r!==n)return __PRIVATE_primitiveComparator(r,n);switch(r){case 0:case 9007199254740991:return 0;case 1:return __PRIVATE_primitiveComparator(e.booleanValue,t.booleanValue);case 2:var i=e,s=t;return i=__PRIVATE_normalizeNumber(i.integerValue||i.doubleValue),s=__PRIVATE_normalizeNumber(s.integerValue||s.doubleValue),i<s?-1:s<i?1:i===s?0:isNaN(i)?isNaN(s)?0:-1:1;case 3:return __PRIVATE_compareTimestamps(e.timestampValue,t.timestampValue);case 4:return __PRIVATE_compareTimestamps(__PRIVATE_getLocalWriteTime(e),__PRIVATE_getLocalWriteTime(t));case 5:return __PRIVATE_primitiveComparator(e.stringValue,t.stringValue);case 6:{i=e.bytesValue;s=t.bytesValue;const p=__PRIVATE_normalizeByteString(i),g=__PRIVATE_normalizeByteString(s);return p.compareTo(g);return}case 7:var a=e.referenceValue,o=t.referenceValue,l=a.split("/"),u=o.split("/");for(let e=0;e<l.length&&e<u.length;e++){const o=__PRIVATE_primitiveComparator(l[e],u[e]);if(0!==o)return o}return __PRIVATE_primitiveComparator(l.length,u.length);case 8:return a=e.geoPointValue,o=t.geoPointValue,0!==(c=__PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(a.latitude),__PRIVATE_normalizeNumber(o.latitude)))?c:__PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(a.longitude),__PRIVATE_normalizeNumber(o.longitude));case 9:var c=e.arrayValue,h=t.arrayValue,_=c.values||[],d=h.values||[];for(let e=0;e<_.length&&e<d.length;++e){const h=__PRIVATE_valueCompare(_[e],d[e]);if(h)return h}return __PRIVATE_primitiveComparator(_.length,d.length);case 10:{h=e.mapValue;var m=t.mapValue;if(h===N&&m===N)return 0;if(h===N)return 1;if(m===N)return-1;const E=h.fields||{},y=Object.keys(E),T=m.fields||{},A=Object.keys(T);y.sort(),A.sort();for(let e=0;e<y.length&&e<A.length;++e){const m=__PRIVATE_primitiveComparator(y[e],A[e]);if(0!==m)return m;var f=__PRIVATE_valueCompare(E[y[e]],T[A[e]]);if(0!==f)return f}return __PRIVATE_primitiveComparator(y.length,A.length);return}default:throw fail()}}function __PRIVATE_compareTimestamps(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return __PRIVATE_primitiveComparator(e,t);var e=__PRIVATE_normalizeTimestamp(e),t=__PRIVATE_normalizeTimestamp(t),r=__PRIVATE_primitiveComparator(e.seconds,t.seconds);return 0!==r?r:__PRIVATE_primitiveComparator(e.nanos,t.nanos)}function __PRIVATE_refValue(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/`+t.path.canonicalString()}}function isArray(e){return!!e&&"arrayValue"in e}function __PRIVATE_isNullValue(e){return!!e&&"nullValue"in e}function __PRIVATE_isNanValue(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function __PRIVATE_isMapValue(e){return!!e&&"mapValue"in e}function __PRIVATE_deepClone(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const r={mapValue:{fields:{}}};return forEach(t.mapValue.fields,(e,t)=>r.mapValue.fields[e]=__PRIVATE_deepClone(t)),r}if(t.arrayValue){const n={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)n.arrayValue.values[e]=__PRIVATE_deepClone(t.arrayValue.values[e]);return n}return Object.assign({},t)}class Bound{constructor(e,t){this.position=e,this.inclusive=t}}function __PRIVATE_boundEquals(t,r){if(null===t)return null===r;if(null===r)return!1;if(t.inclusive!==r.inclusive||t.position.length!==r.position.length)return!1;for(let e=0;e<t.position.length;e++)if(!__PRIVATE_valueEquals(t.position[e],r.position[e]))return!1;return!0}class Filter{}class FieldFilter extends Filter{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new __PRIVATE_KeyFieldFilter(e,t,r):"array-contains"===t?new __PRIVATE_ArrayContainsFilter(e,r):"in"===t?new __PRIVATE_InFilter(e,r):"not-in"===t?new __PRIVATE_NotInFilter(e,r):"array-contains-any"===t?new __PRIVATE_ArrayContainsAnyFilter(e,r):new FieldFilter(e,t,r)}static createKeyFieldInFilter(e,t,r){return new("in"===t?__PRIVATE_KeyFieldInFilter:__PRIVATE_KeyFieldNotInFilter)(e,r)}matches(e){e=e.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(__PRIVATE_valueCompare(e,this.value)):null!==e&&__PRIVATE_typeOrder(this.value)===__PRIVATE_typeOrder(e)&&this.matchesComparison(__PRIVATE_valueCompare(e,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return fail()}}isInequality(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class CompositeFilter extends Filter{constructor(e,t){super(),this.filters=e,this.op=t,this.D=null}static create(e,t){return new CompositeFilter(e,t)}matches(t){return"and"===this.op?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null===this.D&&(this.D=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.D}getFilters(){return Object.assign([],this.filters)}}function __PRIVATE_filterEquals(e,t){return e instanceof FieldFilter?(r=e,(i=t)instanceof FieldFilter&&r.op===i.op&&r.field.isEqual(i.field)&&__PRIVATE_valueEquals(r.value,i.value)):e instanceof CompositeFilter?(r=e,(n=t)instanceof CompositeFilter&&r.op===n.op&&r.filters.length===n.filters.length&&r.filters.reduce((e,t,r)=>e&&__PRIVATE_filterEquals(t,n.filters[r]),!0)):void fail();var n,r,i}class __PRIVATE_KeyFieldFilter extends FieldFilter{constructor(e,t,r){super(e,t,r),this.key=DocumentKey.fromName(r.referenceValue)}matches(e){e=DocumentKey.comparator(e.key,this.key);return this.matchesComparison(e)}}class __PRIVATE_KeyFieldInFilter extends FieldFilter{constructor(e,t){super(e,"in",t),this.keys=__PRIVATE_extractDocumentKeysFromArrayValue("in",t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class __PRIVATE_KeyFieldNotInFilter extends FieldFilter{constructor(e,t){super(e,"not-in",t),this.keys=__PRIVATE_extractDocumentKeysFromArrayValue("not-in",t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function __PRIVATE_extractDocumentKeysFromArrayValue(e,t){return((null==(t=t.arrayValue)?void 0:t.values)||[]).map(e=>DocumentKey.fromName(e.referenceValue))}class __PRIVATE_ArrayContainsFilter extends FieldFilter{constructor(e,t){super(e,"array-contains",t)}matches(e){e=e.data.field(this.field);return isArray(e)&&__PRIVATE_arrayValueContains(e.arrayValue,this.value)}}class __PRIVATE_InFilter extends FieldFilter{constructor(e,t){super(e,"in",t)}matches(e){e=e.data.field(this.field);return null!==e&&__PRIVATE_arrayValueContains(this.value.arrayValue,e)}}class __PRIVATE_NotInFilter extends FieldFilter{constructor(e,t){super(e,"not-in",t)}matches(e){if(__PRIVATE_arrayValueContains(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;e=e.data.field(this.field);return null!==e&&!__PRIVATE_arrayValueContains(this.value.arrayValue,e)}}class __PRIVATE_ArrayContainsAnyFilter extends FieldFilter{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!isArray(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>__PRIVATE_arrayValueContains(this.value.arrayValue,e))}}class OrderBy{constructor(e,t="asc"){this.field=e,this.dir=t}}function __PRIVATE_orderByEquals(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class SnapshotVersion{constructor(e){this.timestamp=e}static fromTimestamp(e){return new SnapshotVersion(e)}static min(){return new SnapshotVersion(new Timestamp(0,0))}static max(){return new SnapshotVersion(new Timestamp(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class SortedMap{constructor(e,t){this.comparator=e,this.root=t||LLRBNode.EMPTY}insert(e,t){return new SortedMap(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}remove(e){return new SortedMap(this.comparator,this.root.remove(e,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:0<r&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){var n=this.comparator(e,r.key);if(0===n)return t+r.left.size;r=n<0?r.left:(t+=r.left.size+1,r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(r){this.inorderTraversal((e,t)=>(r(e,t),!1))}toString(){const r=[];return this.inorderTraversal((e,t)=>(r.push(e+":"+t),!1)),`{${r.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new SortedMapIterator(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new SortedMapIterator(this.root,e,this.comparator,!1)}getReverseIterator(){return new SortedMapIterator(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new SortedMapIterator(this.root,e,this.comparator,!0)}}class SortedMapIterator{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class LLRBNode{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:LLRBNode.RED,this.left=null!=n?n:LLRBNode.EMPTY,this.right=null!=i?i:LLRBNode.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new LLRBNode(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this;var i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return LLRBNode.EMPTY;let e=this;return(e=(e=e.left.isRed()||e.left.left.isRed()?e:e.moveRedLeft()).copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(t(e,n.key)<0)n=(n=n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()?n:n.moveRedLeft()).copy(null,null,null,n.left.remove(e,t),null);else{if(0===t(e,(n=(n=n.left.isRed()?n.rotateRight():n).right.isEmpty()||n.right.isRed()||n.right.left.isRed()?n:n.moveRedRight()).key)){if(n.right.isEmpty())return LLRBNode.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e=(e=(e=e.right.isRed()&&!e.left.isRed()?e.rotateLeft():e).left.isRed()&&e.left.left.isRed()?e.rotateRight():e).left.isRed()&&e.right.isRed()?e.colorFlip():e}moveRedLeft(){let e=this.colorFlip();return e=e.right.left.isRed()?(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip():e}moveRedRight(){let e=this.colorFlip();return e=e.left.left.isRed()?(e=e.rotateRight()).colorFlip():e}rotateLeft(){var e=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw fail();if(this.right.isRed())throw fail();var e=this.left.check();if(e!==this.right.check())throw fail();return e+(this.isRed()?0:1)}}LLRBNode.EMPTY=null,LLRBNode.RED=!0,LLRBNode.BLACK=!1,LLRBNode.EMPTY=new class{constructor(){this.size=0}get key(){throw fail()}get value(){throw fail()}get color(){throw fail()}get left(){throw fail()}get right(){throw fail()}copy(e,t,r,n,i){return this}insert(e,t,r){return new LLRBNode(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class SortedSet{constructor(e){this.comparator=e,this.data=new SortedMap(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(r){this.data.inorderTraversal((e,t)=>(r(e),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){var n=r.getNext();if(0<=this.comparator(n.key,e[1]))return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new SortedSetIterator(this.data.getIterator())}getIteratorFrom(e){return new SortedSetIterator(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof SortedSet))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new SortedSet(this.comparator);return t.data=e,t}}class SortedSetIterator{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class FieldMask{constructor(e){(this.fields=e).sort(FieldPath$1.comparator)}static empty(){return new FieldMask([])}unionWith(e){let t=new SortedSet(FieldPath$1.comparator);for(const e of this.fields)t=t.add(e);for(const r of e)t=t.add(r);return new FieldMask(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return __PRIVATE_arrayEquals(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class ObjectValue{constructor(e){this.value=e}static empty(){return new ObjectValue({mapValue:{}})}field(r){if(r.isEmpty())return this.value;{let t=this.value;for(let e=0;e<r.length-1;++e)if(!__PRIVATE_isMapValue(t=(t.mapValue.fields||{})[r.get(e)]))return null;return(t=(t.mapValue.fields||{})[r.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=__PRIVATE_deepClone(t)}setAll(e){let r=FieldPath$1.emptyPath(),n={},i=[];e.forEach((e,t)=>{if(!r.isImmediateParentOf(t)){const e=this.getFieldsMap(r);this.applyChanges(e,n,i),n={},i=[],r=t.popLast()}e?n[t.lastSegment()]=__PRIVATE_deepClone(e):i.push(t.lastSegment())});e=this.getFieldsMap(r);this.applyChanges(e,n,i)}delete(e){const t=this.field(e.popLast());__PRIVATE_isMapValue(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return __PRIVATE_valueEquals(this.value,e.value)}getFieldsMap(r){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let t=0;t<r.length;++t){let e=n.mapValue.fields[r.get(t)];__PRIVATE_isMapValue(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},n.mapValue.fields[r.get(t)]=e),n=e}return n.mapValue.fields}applyChanges(r,e,t){forEach(e,(e,t)=>r[e]=t);for(const e of t)delete r[e]}clone(){return new ObjectValue(__PRIVATE_deepClone(this.value))}}class MutableDocument{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new MutableDocument(e,0,SnapshotVersion.min(),SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}static newFoundDocument(e,t,r,n){return new MutableDocument(e,1,t,SnapshotVersion.min(),r,n,0)}static newNoDocument(e,t){return new MutableDocument(e,2,t,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}static newUnknownDocument(e,t){return new MutableDocument(e,3,t,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(SnapshotVersion.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ObjectValue.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ObjectValue.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=SnapshotVersion.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof MutableDocument&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new MutableDocument(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class __PRIVATE_TargetImpl{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.C=null}}function __PRIVATE_newTarget(e,t=null,r=[],n=[],i=null,s=null,a=null){return new __PRIVATE_TargetImpl(e,t,r,n,i,s,a)}class __PRIVATE_QueryImpl{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.S=null,this.N=null,this.O=null,this.startAt,this.endAt}}function __PRIVATE_isCollectionGroupQuery(e){return null!==e.collectionGroup}function __PRIVATE_queryNormalizedOrderBy(t){const r=__PRIVATE_debugCast(t);if(null===r.S){r.S=[];const t=new Set;for(const i of r.explicitOrderBy)r.S.push(i),t.add(i.field.canonicalString());const n=0<r.explicitOrderBy.length?r.explicitOrderBy[r.explicitOrderBy.length-1].dir:"asc",e=function(e){let t=new SortedSet(FieldPath$1.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(r);e.forEach(e=>{t.has(e.canonicalString())||e.isKeyField()||r.S.push(new OrderBy(e,n))}),t.has(FieldPath$1.keyField().canonicalString())||r.S.push(new OrderBy(FieldPath$1.keyField(),n))}return r.S}function __PRIVATE_queryToTarget(e){const t=__PRIVATE_debugCast(e);return t.N||(t.N=__PRIVATE__queryToTarget(t,__PRIVATE_queryNormalizedOrderBy(e))),t.N}function __PRIVATE__queryToTarget(e,t){if("F"===e.limitType)return __PRIVATE_newTarget(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);t=t.map(e=>{var t="desc"===e.dir?"asc":"desc";return new OrderBy(e.field,t)});var r=e.endAt?new Bound(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new Bound(e.startAt.position,e.startAt.inclusive):null;return __PRIVATE_newTarget(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}function __PRIVATE_queryWithAddedFilter(e,t){t=e.filters.concat([t]);return new __PRIVATE_QueryImpl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)}function toNumber(e,t){if("number"==typeof(r=t)&&Number.isInteger(r)&&!__PRIVATE_isNegativeZero(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER)return{integerValue:""+t};var r=t;if(e.useProto3Json){if(isNaN(r))return{doubleValue:"NaN"};if(r===1/0)return{doubleValue:"Infinity"};if(r===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:__PRIVATE_isNegativeZero(r)?"-0":r}}class TransformOperation{constructor(){this._=void 0}}class __PRIVATE_ServerTimestampTransform extends TransformOperation{}class __PRIVATE_ArrayUnionTransformOperation extends TransformOperation{constructor(e){super(),this.elements=e}}class __PRIVATE_ArrayRemoveTransformOperation extends TransformOperation{constructor(e){super(),this.elements=e}}class __PRIVATE_NumericIncrementTransformOperation extends TransformOperation{constructor(e,t){super(),this.serializer=e,this.q=t}}class FieldTransform{constructor(e,t){this.field=e,this.transform=t}}class Precondition{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Precondition}static exists(e){return new Precondition(void 0,e)}static updateTime(e){return new Precondition(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}class Mutation{}class __PRIVATE_SetMutation extends Mutation{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class __PRIVATE_PatchMutation extends Mutation{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}class __PRIVATE_DeleteMutation extends Mutation{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class __PRIVATE_VerifyMutation extends Mutation{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}const k={asc:"ASCENDING",desc:"DESCENDING"},O={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},L={and:"AND",or:"OR"};class JsonProtoSerializer{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function toTimestamp(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function __PRIVATE_toBytes(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function __PRIVATE_toVersion(e,t){return toTimestamp(e,t.toTimestamp())}function __PRIVATE_fromVersion(e){return __PRIVATE_hardAssert(!!e),SnapshotVersion.fromTimestamp(function(e){e=__PRIVATE_normalizeTimestamp(e);return new Timestamp(e.seconds,e.nanos)}(e))}function __PRIVATE_toResourceName(e,t){return e=e,new ResourcePath(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function __PRIVATE_toName(e,t){return __PRIVATE_toResourceName(e.databaseId,t.path)}function fromName(e,t){const r=function(e){e=ResourcePath.fromString(e);return __PRIVATE_hardAssert(__PRIVATE_isValidResourceName(e)),e}(t);if(r.get(1)!==e.databaseId.projectId)throw new FirestoreError(m,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new FirestoreError(m,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new DocumentKey((__PRIVATE_hardAssert(4<(t=r).length&&"documents"===t.get(4)),t.popFirst(5)))}function __PRIVATE_toQueryPath(e,t){return __PRIVATE_toResourceName(e.databaseId,t)}function __PRIVATE_getEncodedDatabaseId(e){return new ResourcePath(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function __PRIVATE_toMutationDocument(e,t,r){return{name:__PRIVATE_toName(e,t),fields:r.value.mapValue.fields}}function __PRIVATE_toQueryTarget(e,t){const r={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(r.parent=__PRIVATE_toQueryPath(e,n),r.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r.parent=__PRIVATE_toQueryPath(e,n.popLast()),r.structuredQuery.from=[{collectionId:n.lastSegment()}]);var i=function(e){if(0!==e.length)return __PRIVATE_toFilter(CompositeFilter.create(e,"and"))}(t.filters),i=(i&&(r.structuredQuery.where=i),function(e){if(0!==e.length)return e.map(e=>{return{field:__PRIVATE_toFieldPathReference(e.field),direction:__PRIVATE_toDirection(e.dir)}})}(t.orderBy)),e=(i&&(r.structuredQuery.orderBy=i),i=t.limit,e.useProto3Json||__PRIVATE_isNullOrUndefined(i)?i:{value:i});return null!==e&&(r.structuredQuery.limit=e),t.startAt&&(r.structuredQuery.startAt={before:(i=t.startAt).inclusive,values:i.position}),t.endAt&&(r.structuredQuery.endAt={before:!(e=t.endAt).inclusive,values:e.position}),r}function __PRIVATE_toDirection(e){return k[e]}function __PRIVATE_toOperatorName(e){return O[e]}function __PRIVATE_toCompositeOperatorName(e){return L[e]}function __PRIVATE_toFieldPathReference(e){return{fieldPath:e.canonicalString()}}function __PRIVATE_toFilter(e){if(e instanceof FieldFilter){var t=e;if("=="===t.op){if(__PRIVATE_isNanValue(t.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(t.field),op:"IS_NAN"}};if(__PRIVATE_isNullValue(t.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(__PRIVATE_isNanValue(t.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(t.field),op:"IS_NOT_NAN"}};if(__PRIVATE_isNullValue(t.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:__PRIVATE_toFieldPathReference(t.field),op:__PRIVATE_toOperatorName(t.op),value:t.value}}}return e instanceof CompositeFilter?1===(e=(t=e).getFilters().map(e=>__PRIVATE_toFilter(e))).length?e[0]:{compositeFilter:{op:__PRIVATE_toCompositeOperatorName(t.op),filters:e}}:fail()}function __PRIVATE_toDocumentMask(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function __PRIVATE_isValidResourceName(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function __PRIVATE_newSerializer(e){return new JsonProtoSerializer(e,!0)}class __PRIVATE_ExponentialBackoff{constructor(e,t,r=1e3,n=1.5,i=6e4){this.B=e,this.timerId=t,this.$=r,this.L=n,this.M=i,this.k=0,this.U=null,this.j=Date.now(),this.reset()}reset(){this.k=0}W(){this.k=this.M}K(e){this.cancel();var t=Math.floor(this.k+this.G()),r=Math.max(0,Date.now()-this.j),n=Math.max(0,t-r);0<n&&__PRIVATE_logDebug("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.k} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.U=this.B.enqueueAfterDelay(this.timerId,n,()=>(this.j=Date.now(),e())),this.k*=this.L,this.k<this.$&&(this.k=this.$),this.k>this.M&&(this.k=this.M)}H(){null!==this.U&&(this.U.skipDelay(),this.U=null)}cancel(){null!==this.U&&(this.U.cancel(),this.U=null)}G(){return(Math.random()-.5)*this.k}}class __PRIVATE_DatastoreImpl extends class{}{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.J=!1}Y(){if(this.J)throw new FirestoreError(A,"The client has already been terminated.")}R(r,n,i){return this.Y(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.R(r,n,i,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===T&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new FirestoreError(f,e.toString())})}g(r,n,i,s){return this.Y(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.connection.g(r,n,i,e,t,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===T&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new FirestoreError(f,e.toString())})}terminate(){this.J=!0}}async function __PRIVATE_invokeCommitRpc(e,t){const n=__PRIVATE_debugCast(e),r=__PRIVATE_getEncodedDatabaseId(n.serializer)+"/documents",i={writes:t.map(t=>{{var r=n.serializer;let e;if(t instanceof __PRIVATE_SetMutation)e={update:__PRIVATE_toMutationDocument(r,t.key,t.value)};else if(t instanceof __PRIVATE_DeleteMutation)e={delete:__PRIVATE_toName(r,t.key)};else if(t instanceof __PRIVATE_PatchMutation)e={update:__PRIVATE_toMutationDocument(r,t.key,t.data),updateMask:__PRIVATE_toDocumentMask(t.fieldMask)};else{if(!(t instanceof __PRIVATE_VerifyMutation))return fail();e={verify:__PRIVATE_toName(r,t.key)}}return 0<t.fieldTransforms.length&&(e.updateTransforms=t.fieldTransforms.map(e=>{var t=e.transform;if(t instanceof __PRIVATE_ServerTimestampTransform)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof __PRIVATE_ArrayUnionTransformOperation)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof __PRIVATE_ArrayRemoveTransformOperation)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof __PRIVATE_NumericIncrementTransformOperation)return{fieldPath:e.field.canonicalString(),increment:t.q};throw fail()})),t.precondition.isNone||(e.currentDocument=(r=r,void 0!==(t=t.precondition).updateTime?{updateTime:__PRIVATE_toVersion(r,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:fail())),e}})};await n.R("Commit",r,i)}async function __PRIVATE_invokeBatchGetDocumentsRpc(e,t){const o=__PRIVATE_debugCast(e),r=__PRIVATE_getEncodedDatabaseId(o.serializer)+"/documents",n={documents:t.map(e=>__PRIVATE_toName(o.serializer,e))},i=await o.g("BatchGetDocuments",r,n,t.length),l=new Map,s=(i.forEach(e=>{r=o.serializer;const t="found"in(e=e)?(n=r,__PRIVATE_hardAssert(!!(i=e).found),i.found.name,i.found.updateTime,n=fromName(n,i.found.name),s=__PRIVATE_fromVersion(i.found.updateTime),a=i.found.createTime?__PRIVATE_fromVersion(i.found.createTime):SnapshotVersion.min(),i=new ObjectValue({mapValue:{fields:i.found.fields}}),MutableDocument.newFoundDocument(n,s,a,i)):"missing"in e?(n=r,__PRIVATE_hardAssert(!!(s=e).missing),__PRIVATE_hardAssert(!!s.readTime),n=fromName(n,s.missing),s=__PRIVATE_fromVersion(s.readTime),MutableDocument.newNoDocument(n,s)):fail();var r,n,i,s,a;l.set(t.key.toString(),t)}),[]);return t.forEach(e=>{e=l.get(e.toString());__PRIVATE_hardAssert(!!e),s.push(e)}),s}const M=new Map;function __PRIVATE_getDatastore(e){if(e._terminated)throw new FirestoreError(A,"The client has already been terminated.");var t,r,n,i;return M.has(e)||(__PRIVATE_logDebug("ComponentProvider","Initializing Datastore"),t=e._databaseId,r=e.app.options.appId||"",n=e._persistenceKey,i=e._freezeSettings(),t=new DatabaseInfo(t,r,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,__PRIVATE_cloneLongPollingOptions(i.experimentalLongPollingOptions),i.useFetchStreams),r=new __PRIVATE_FetchConnection(t,fetch.bind(null)),n=__PRIVATE_newSerializer(e._databaseId),i=e._authCredentials,t=e._appCheckCredentials,r=r,n=n,i=new __PRIVATE_DatastoreImpl(i,t,r,n),M.set(e,i)),M.get(e)}class FirestoreSettingsImpl{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new FirestoreError(m,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new FirestoreError(m,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}var t="experimentalForceLongPolling",r=e.experimentalForceLongPolling,n="experimentalAutoDetectLongPolling",i=e.experimentalAutoDetectLongPolling;if(!0===r&&!0===i)throw new FirestoreError(m,t+` and ${n} cannot be used together.`);this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=__PRIVATE_cloneLongPollingOptions(null!=(r=e.experimentalLongPollingOptions)?r:{});i=this.experimentalLongPollingOptions;if(void 0!==i.timeoutSeconds){if(isNaN(i.timeoutSeconds))throw new FirestoreError(m,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new FirestoreError(m,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(30<i.timeoutSeconds)throw new FirestoreError(m,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,r=e.experimentalLongPollingOptions,t.timeoutSeconds===r.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,r}}class Firestore{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new FirestoreSettingsImpl({}),this._settingsFrozen=!1}get app(){if(this._app)return this._app;throw new FirestoreError(A,"Firestore was not initialized using the Firebase SDK. 'app' is not available")}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new FirestoreError(A,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new FirestoreSettingsImpl(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new __PRIVATE_EmptyAuthCredentialsProvider;switch(e.type){case"firstParty":return new __PRIVATE_FirstPartyAuthCredentialsProvider(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new FirestoreError(m,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){{var e=this;const t=M.get(e);t&&(__PRIVATE_logDebug("ComponentProvider","Removing Datastore"),M.delete(e),t.terminate())}return Promise.resolve()}}function initializeFirestore(e,t,r){r=r||"(default)";const n=_getProvider(e,"firestore/lite");if(n.isInitialized(r))throw new FirestoreError(A,"Firestore can only be initialized once per app.");return n.initialize({options:t,instanceIdentifier:r})}function getFirestore(e,t){var n="object"==typeof e?e:r(),e="string"==typeof e?e:t||"(default)",t=_getProvider(n,"firestore/lite").getImmediate({identifier:e});if(!t._initialized){const e=getDefaultEmulatorHostnameAndPort("firestore");e&&connectFirestoreEmulator(t,...e)}return t}function connectFirestoreEmulator(r,n,e,i={}){const s=(r=__PRIVATE_cast(r,Firestore))._getSettings(),t=n+":"+e;if("firestore.googleapis.com"!==s.host&&s.host!==t&&__PRIVATE_logWarn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:t,ssl:!1})),i.mockUserToken){let e,t;if("string"==typeof i.mockUserToken)e=i.mockUserToken,t=User.MOCK_USER;else{e=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var t=t||"demo-project",r=e.iat||0,n=e.sub||e.user_id;if(!n)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");t=Object.assign({iss:"https://securetoken.google.com/"+t,aud:t,iat:r,exp:r+3600,auth_time:r,sub:n,user_id:n,firebase:{sign_in_provider:"custom",identities:{}}},e);return[base64urlEncodeWithoutPadding(JSON.stringify({alg:"none",type:"JWT"})),base64urlEncodeWithoutPadding(JSON.stringify(t)),""].join(".")}(i.mockUserToken,null==(n=r._app)?void 0:n.options.projectId);const s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new FirestoreError(m,"mockUserToken must contain 'sub' or 'user_id' field!");t=new User(s)}r._authCredentials=new __PRIVATE_EmulatorAuthCredentialsProvider(new __PRIVATE_OAuthToken(e,t))}}function terminate(e){return e=__PRIVATE_cast(e,Firestore),n(e.app,"firestore/lite"),e._delete()}class AggregateField{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class AggregateQuerySnapshot{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class Query{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Query(this.firestore,e,this._query)}}class DocumentReference{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new CollectionReference(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new DocumentReference(this.firestore,e,this._key)}}class CollectionReference extends Query{constructor(e,t,r){super(e,t,(e=r,new __PRIVATE_QueryImpl(e))),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new DocumentReference(this.firestore,null,new DocumentKey(e))}withConverter(e){return new CollectionReference(this.firestore,e,this._path)}}function collection(e,t,...r){if(e=getModularInstance(e),__PRIVATE_validateNonEmptyArgument("collection","path",t),e instanceof Firestore)return __PRIVATE_validateCollectionPath(n=ResourcePath.fromString(t,...r)),new CollectionReference(e,null,n);if(!(e instanceof DocumentReference||e instanceof CollectionReference))throw new FirestoreError(m,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var n=e._path.child(ResourcePath.fromString(t,...r));return __PRIVATE_validateCollectionPath(n),new CollectionReference(e.firestore,null,n)}function collectionGroup(e,t){if(e=__PRIVATE_cast(e,Firestore),__PRIVATE_validateNonEmptyArgument("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new FirestoreError(m,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Query(e,null,(e=t,new __PRIVATE_QueryImpl(ResourcePath.emptyPath(),e)))}function doc(e,t,...r){if(e=getModularInstance(e),__PRIVATE_validateNonEmptyArgument("doc","path",t=1===arguments.length?__PRIVATE_AutoId.newId():t),e instanceof Firestore)return __PRIVATE_validateDocumentPath(n=ResourcePath.fromString(t,...r)),new DocumentReference(e,null,new DocumentKey(n));if(!(e instanceof DocumentReference||e instanceof CollectionReference))throw new FirestoreError(m,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var n=e._path.child(ResourcePath.fromString(t,...r));return __PRIVATE_validateDocumentPath(n),new DocumentReference(e.firestore,e instanceof CollectionReference?e.converter:null,new DocumentKey(n))}function refEqual(e,t){return e=getModularInstance(e),t=getModularInstance(t),(e instanceof DocumentReference||e instanceof CollectionReference)&&(t instanceof DocumentReference||t instanceof CollectionReference)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function queryEqual(e,t){return e=getModularInstance(e),t=getModularInstance(t),e instanceof Query&&t instanceof Query&&e.firestore===t.firestore&&(r=e._query,n=t._query,function(t,r){if(t.limit!==r.limit)return!1;if(t.orderBy.length!==r.orderBy.length)return!1;for(let e=0;e<t.orderBy.length;e++)if(!__PRIVATE_orderByEquals(t.orderBy[e],r.orderBy[e]))return!1;if(t.filters.length!==r.filters.length)return!1;for(let e=0;e<t.filters.length;e++)if(!__PRIVATE_filterEquals(t.filters[e],r.filters[e]))return!1;return t.collectionGroup===r.collectionGroup&&!!t.path.isEqual(r.path)&&!!__PRIVATE_boundEquals(t.startAt,r.startAt)&&__PRIVATE_boundEquals(t.endAt,r.endAt)}(__PRIVATE_queryToTarget(r),__PRIVATE_queryToTarget(n))&&r.limitType===n.limitType)&&e.converter===t.converter;var r,n}class Bytes{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Bytes(ByteString.fromBase64String(e))}catch(e){throw new FirestoreError(m,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Bytes(ByteString.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class FieldPath{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new FirestoreError(m,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new FieldPath$1(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function documentId(){return new FieldPath("__name__")}class FieldValue{constructor(e){this._methodName=e}}class GeoPoint{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new FirestoreError(m,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new FirestoreError(m,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return __PRIVATE_primitiveComparator(this._lat,e._lat)||__PRIVATE_primitiveComparator(this._long,e._long)}}const q=/^__.*__$/;class ParsedSetData{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new __PRIVATE_PatchMutation(e,this.data,this.fieldMask,t,this.fieldTransforms):new __PRIVATE_SetMutation(e,this.data,t,this.fieldTransforms)}}class ParsedUpdateData{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new __PRIVATE_PatchMutation(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function __PRIVATE_isWrite(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw fail()}}class __PRIVATE_ParseContextImpl{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.X(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get tt(){return this.settings.tt}et(e){return new __PRIVATE_ParseContextImpl(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}rt(e){var t;const r=null==(t=this.path)?void 0:t.child(e),n=this.et({path:r,nt:!1});return n.it(e),n}st(e){var t;const r=null==(t=this.path)?void 0:t.child(e),n=this.et({path:r,nt:!1});return n.X(),n}ot(e){return this.et({path:void 0,nt:!0})}ut(e){return __PRIVATE_createError(e,this.settings.methodName,this.settings._t||!1,this.path,this.settings.ct)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}X(){if(this.path)for(let e=0;e<this.path.length;e++)this.it(this.path.get(e))}it(e){if(0===e.length)throw this.ut("Document fields must not be empty");if(__PRIVATE_isWrite(this.tt)&&q.test(e))throw this.ut('Document fields cannot begin and end with "__"')}}class __PRIVATE_UserDataReader{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||__PRIVATE_newSerializer(e)}lt(e,t,r,n=!1){return new __PRIVATE_ParseContextImpl({tt:e,methodName:t,ct:r,path:FieldPath$1.emptyPath(),nt:!1,_t:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function __PRIVATE_newUserDataReader(e){var t=e._freezeSettings(),r=__PRIVATE_newSerializer(e._databaseId);return new __PRIVATE_UserDataReader(e._databaseId,!!t.ignoreUndefinedProperties,r)}function __PRIVATE_parseSetData(e,t,r,n,i,s={}){const a=e.lt(s.merge||s.mergeFields?2:0,t,r,i);__PRIVATE_validatePlainObject("Data must be an object, but it was:",a,n);e=__PRIVATE_parseObject(n,a);let o,l;if(s.merge)o=new FieldMask(a.fieldMask),l=a.fieldTransforms;else if(s.mergeFields){const e=[];for(const n of s.mergeFields){const i=__PRIVATE_fieldPathFromArgument$1(t,n,r);if(!a.contains(i))throw new FirestoreError(m,`Field '${i}' is specified in your field mask but missing from your input data.`);__PRIVATE_fieldMaskContains(e,i)||e.push(i)}o=new FieldMask(e),l=a.fieldTransforms.filter(e=>o.covers(e.field))}else o=null,l=a.fieldTransforms;return new ParsedSetData(new ObjectValue(e),o,l)}class __PRIVATE_DeleteFieldValueImpl extends FieldValue{_toFieldTransform(e){if(2!==e.tt)throw 1===e.tt?e.ut(this._methodName+"() can only appear at the top level of your update data"):e.ut(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof __PRIVATE_DeleteFieldValueImpl}}function __PRIVATE_createSentinelChildContext(e,t,r){return new __PRIVATE_ParseContextImpl({tt:3,ct:t.settings.ct,methodName:e._methodName,nt:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class __PRIVATE_ServerTimestampFieldValueImpl extends FieldValue{_toFieldTransform(e){return new FieldTransform(e.path,new __PRIVATE_ServerTimestampTransform)}isEqual(e){return e instanceof __PRIVATE_ServerTimestampFieldValueImpl}}class __PRIVATE_ArrayUnionFieldValueImpl extends FieldValue{constructor(e,t){super(e),this.ht=t}_toFieldTransform(e){const t=__PRIVATE_createSentinelChildContext(this,e,!0),r=this.ht.map(e=>__PRIVATE_parseData(e,t)),n=new __PRIVATE_ArrayUnionTransformOperation(r);return new FieldTransform(e.path,n)}isEqual(e){return this===e}}class __PRIVATE_ArrayRemoveFieldValueImpl extends FieldValue{constructor(e,t){super(e),this.ht=t}_toFieldTransform(e){const t=__PRIVATE_createSentinelChildContext(this,e,!0),r=this.ht.map(e=>__PRIVATE_parseData(e,t)),n=new __PRIVATE_ArrayRemoveTransformOperation(r);return new FieldTransform(e.path,n)}isEqual(e){return this===e}}class __PRIVATE_NumericIncrementFieldValueImpl extends FieldValue{constructor(e,t){super(e),this.dt=t}_toFieldTransform(e){var t=new __PRIVATE_NumericIncrementTransformOperation(e.serializer,toNumber(e.serializer,this.dt));return new FieldTransform(e.path,t)}isEqual(e){return this===e}}function __PRIVATE_parseUpdateData(e,i,s,t){const a=e.lt(1,i,s),o=(__PRIVATE_validatePlainObject("Data must be an object, but it was:",a,t),[]),l=ObjectValue.empty();forEach(t,(e,t)=>{var r=__PRIVATE_fieldPathFromDotSeparatedString(i,e,s),n=(t=getModularInstance(t),a.st(r));if(t instanceof __PRIVATE_DeleteFieldValueImpl)o.push(r);else{const e=__PRIVATE_parseData(t,n);null!=e&&(o.push(r),l.set(r,e))}});e=new FieldMask(o);return new ParsedUpdateData(l,e,a.fieldTransforms)}function __PRIVATE_parseUpdateVarargs(t,r,e,n,i,s){const a=t.lt(1,r,e),o=[__PRIVATE_fieldPathFromArgument$1(r,n,e)],l=[i];if(s.length%2!=0)throw new FirestoreError(m,`Function ${r}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(__PRIVATE_fieldPathFromArgument$1(r,s[e])),l.push(s[e+1]);const u=[],c=ObjectValue.empty();for(let e=o.length-1;0<=e;--e)if(!__PRIVATE_fieldMaskContains(u,o[e])){const r=o[e];var h=getModularInstance(l[e]);const n=a.st(r);if(h instanceof __PRIVATE_DeleteFieldValueImpl)u.push(r);else{const t=__PRIVATE_parseData(h,n);null!=t&&(u.push(r),c.set(r,t))}}t=new FieldMask(u);return new ParsedUpdateData(c,t,a.fieldTransforms)}function __PRIVATE_parseQueryValue(e,t,r,n=!1){return __PRIVATE_parseData(r,e.lt(n?4:3,t))}function __PRIVATE_parseData(e,r){if(__PRIVATE_looksLikeJsonObject(e=getModularInstance(e)))return __PRIVATE_validatePlainObject("Unsupported field value:",r,e),__PRIVATE_parseObject(e,r);if(e instanceof FieldValue){{var t=e;var n=r;if(!__PRIVATE_isWrite(n.tt))throw n.ut(t._methodName+"() can only be used with update() and set()");if(!n.path)throw n.ut(t._methodName+"() is not currently supported inside arrays");t=t._toFieldTransform(n);t&&n.fieldTransforms.push(t)}return null}if(void 0===e&&r.ignoreUndefinedProperties)return null;if(r.path&&r.fieldMask.push(r.path),e instanceof Array){if(r.settings.nt&&4!==r.tt)throw r.ut("Nested arrays are not supported");{var i=r;const a=[];let t=0;for(const o of e){let e=__PRIVATE_parseData(o,i.ot(t));null==e&&(e={nullValue:"NULL_VALUE"}),a.push(e),t++}return{arrayValue:{values:a}}}}var s,n=e,t=r;if(null===(n=getModularInstance(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return toNumber(t.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date)return s=Timestamp.fromDate(n),{timestampValue:toTimestamp(t.serializer,s)};if(n instanceof Timestamp)return s=new Timestamp(n.seconds,1e3*Math.floor(n.nanoseconds/1e3)),{timestampValue:toTimestamp(t.serializer,s)};if(n instanceof GeoPoint)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Bytes)return{bytesValue:__PRIVATE_toBytes(t.serializer,n._byteString)};if(n instanceof DocumentReference){const l=t.databaseId,u=n.firestore._databaseId;if(u.isEqual(l))return{referenceValue:__PRIVATE_toResourceName(n.firestore._databaseId||t.databaseId,n._key.path)};throw t.ut(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${l.projectId}/`+l.database)}throw t.ut("Unsupported field value: "+__PRIVATE_valueDescription(n))}function __PRIVATE_parseObject(e,r){const n={};return function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return;return 1}(e)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):forEach(e,(e,t)=>{t=__PRIVATE_parseData(t,r.rt(e));null!=t&&(n[e]=t)}),{mapValue:{fields:n}}}function __PRIVATE_looksLikeJsonObject(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Timestamp||e instanceof GeoPoint||e instanceof Bytes||e instanceof DocumentReference||e instanceof FieldValue)}function __PRIVATE_validatePlainObject(e,t,r){var n;if(!__PRIVATE_looksLikeJsonObject(r)||("object"!=typeof(n=r)||null===n||Object.getPrototypeOf(n)!==Object.prototype&&null!==Object.getPrototypeOf(n)))throw"an object"===(n=__PRIVATE_valueDescription(r))?t.ut(e+" a custom object"):t.ut(e+" "+n)}function __PRIVATE_fieldPathFromArgument$1(e,t,r){if((t=getModularInstance(t))instanceof FieldPath)return t._internalPath;if("string"==typeof t)return __PRIVATE_fieldPathFromDotSeparatedString(e,t);throw __PRIVATE_createError("Field path arguments must be of type string or ",e,!1,void 0,r)}const B=new RegExp("[~\\*/\\[\\]]");function __PRIVATE_fieldPathFromDotSeparatedString(t,r,n){if(0<=r.search(B))throw __PRIVATE_createError(`Invalid field path (${r}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new FieldPath(...r.split("."))._internalPath}catch(e){throw __PRIVATE_createError(`Invalid field path (${r}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function __PRIVATE_createError(e,t,r,n,i){var s=n&&!n.isEmpty(),a=void 0!==i;let o=`Function ${t}() called with invalid data`,l=(r&&(o+=" (via `toFirestore()`)"),o+=". ","");return(s||a)&&(l+=" (found",s&&(l+=" in field "+n),a&&(l+=" in document "+i),l+=")"),new FirestoreError(m,o+e+l)}function __PRIVATE_fieldMaskContains(e,t){return e.some(e=>e.isEqual(t))}class DocumentSnapshot{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new DocumentReference(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){var e;if(this._document)return this._converter?(e=new QueryDocumentSnapshot(this._firestore,this._userDataWriter,this._key,this._document,null),this._converter.fromFirestore(e)):this._userDataWriter.convertValue(this._document.data.value)}get(e){if(this._document){e=this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e)}}}class QueryDocumentSnapshot extends DocumentSnapshot{data(){return super.data()}}class QuerySnapshot{constructor(e,t){this._docs=t,this.query=e}get docs(){return[...this._docs]}get size(){return this.docs.length}get empty(){return 0===this.docs.length}forEach(e,t){this._docs.forEach(e,t)}}function snapshotEqual(e,t){return e=getModularInstance(e),t=getModularInstance(t),e instanceof DocumentSnapshot&&t instanceof DocumentSnapshot?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof QuerySnapshot&&t instanceof QuerySnapshot&&queryEqual(e.query,t.query)&&__PRIVATE_arrayEquals(e.docs,t.docs,snapshotEqual)}function __PRIVATE_fieldPathFromArgument(e,t){return"string"==typeof t?__PRIVATE_fieldPathFromDotSeparatedString(e,t):(t instanceof FieldPath?t:t._delegate)._internalPath}class AppliableConstraint{}class QueryConstraint extends AppliableConstraint{}function query(e,t,...r){let n=[];t instanceof AppliableConstraint&&n.push(t),n=n.concat(r);r=(t=n).filter(e=>e instanceof QueryCompositeFilterConstraint).length,t=t.filter(e=>e instanceof QueryFieldFilterConstraint).length;if(1<r||0<r&&0<t)throw new FirestoreError(m,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.");for(const t of n)e=t._apply(e);return e}class QueryFieldFilterConstraint extends QueryConstraint{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new QueryFieldFilterConstraint(e,t,r)}_apply(e){var t=this._parse(e);return __PRIVATE_validateNewFieldFilter(e._query,t),new Query(e.firestore,e.converter,__PRIVATE_queryWithAddedFilter(e._query,t))}_parse(t){var r=__PRIVATE_newUserDataReader(t.firestore);{var n=t._query,i="where",s=r,a=t.firestore._databaseId,o=(r=this._field,t=this._op,this._value);let e;if(r.isKeyField()){if("array-contains"===t||"array-contains-any"===t)throw new FirestoreError(m,`Invalid Query. You can't perform '${t}' queries on documentId().`);if("in"===t||"not-in"===t){__PRIVATE_validateDisjunctiveFilterElements(o,t);const i=[];for(const s of o)i.push(__PRIVATE_parseDocumentIdValue(a,n,s));e={arrayValue:{values:i}}}else e=__PRIVATE_parseDocumentIdValue(a,n,o)}else"in"!==t&&"not-in"!==t&&"array-contains-any"!==t||__PRIVATE_validateDisjunctiveFilterElements(o,t),e=__PRIVATE_parseQueryValue(s,i,o,"in"===t||"not-in"===t);return FieldFilter.create(r,t,e)}}}function where(e,t,r){e=__PRIVATE_fieldPathFromArgument("where",e);return QueryFieldFilterConstraint._create(e,t,r)}class QueryCompositeFilterConstraint extends AppliableConstraint{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new QueryCompositeFilterConstraint(e,t)}_parse(t){var e=this._queryConstraints.map(e=>e._parse(t)).filter(e=>0<e.getFilters().length);return 1===e.length?e[0]:CompositeFilter.create(e,this._getOperator())}_apply(t){const r=this._parse(t);{if(0===r.getFilters().length)return t;{var n=t._query,i=r;let e=n;for(const n of i.getFlattenedFilters())__PRIVATE_validateNewFieldFilter(e,n),e=__PRIVATE_queryWithAddedFilter(e,n)}return new Query(t.firestore,t.converter,__PRIVATE_queryWithAddedFilter(t._query,r))}}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function or(...e){return e.forEach(e=>__PRIVATE_validateQueryFilterConstraint("or",e)),QueryCompositeFilterConstraint._create("or",e)}function and(...e){return e.forEach(e=>__PRIVATE_validateQueryFilterConstraint("and",e)),QueryCompositeFilterConstraint._create("and",e)}class QueryOrderByConstraint extends QueryConstraint{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new QueryOrderByConstraint(e,t)}_apply(e){var t=function(e,t,r){if(null!==e.startAt)throw new FirestoreError(m,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new FirestoreError(m,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new OrderBy(t,r)}(e._query,this._field,this._direction);return new Query(e.firestore,e.converter,function(e,t){t=e.explicitOrderBy.concat([t]);return new __PRIVATE_QueryImpl(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function orderBy(e,t="asc"){e=__PRIVATE_fieldPathFromArgument("orderBy",e);return QueryOrderByConstraint._create(e,t)}class QueryLimitConstraint extends QueryConstraint{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new QueryLimitConstraint(e,t,r)}_apply(e){return new Query(e.firestore,e.converter,(e=e._query,t=this._limit,r=this._limitType,new __PRIVATE_QueryImpl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)));var t,r}}function limit(e){return __PRIVATE_validatePositiveNumber("limit",e),QueryLimitConstraint._create("limit",e,"F")}function limitToLast(e){return __PRIVATE_validatePositiveNumber("limitToLast",e),QueryLimitConstraint._create("limitToLast",e,"L")}class QueryStartAtConstraint extends QueryConstraint{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new QueryStartAtConstraint(e,t,r)}_apply(e){var t=__PRIVATE_newQueryBoundFromDocOrFields(e,this.type,this._docOrFields,this._inclusive);return new Query(e.firestore,e.converter,(e=e._query,t=t,new __PRIVATE_QueryImpl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)))}}function startAt(...e){return QueryStartAtConstraint._create("startAt",e,!0)}function startAfter(...e){return QueryStartAtConstraint._create("startAfter",e,!1)}class QueryEndAtConstraint extends QueryConstraint{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new QueryEndAtConstraint(e,t,r)}_apply(e){var t=__PRIVATE_newQueryBoundFromDocOrFields(e,this.type,this._docOrFields,this._inclusive);return new Query(e.firestore,e.converter,(e=e._query,t=t,new __PRIVATE_QueryImpl(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)))}}function endBefore(...e){return QueryEndAtConstraint._create("endBefore",e,!1)}function endAt(...e){return QueryEndAtConstraint._create("endAt",e,!0)}function __PRIVATE_newQueryBoundFromDocOrFields(e,t,r,n){if(r[0]=getModularInstance(r[0]),r[0]instanceof DocumentSnapshot){var i=e._query,s=e.firestore._databaseId,a=t,o=r[0]._document,l=n;if(!o)throw new FirestoreError(g,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const f=[];for(const a of __PRIVATE_queryNormalizedOrderBy(i))if(a.field.isKeyField())f.push(__PRIVATE_refValue(s,o.key));else{const i=o.data.field(a.field);if(__PRIVATE_isServerTimestamp(i))throw new FirestoreError(m,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===i){const i=a.field.canonicalString();throw new FirestoreError(m,`Invalid query. You are trying to start or end a query using a document for which the field '${i}' (used as the orderBy) does not exist.`)}f.push(i)}return new Bound(f,l)}a=__PRIVATE_newUserDataReader(e.firestore);{var u=e._query,c=e.firestore._databaseId,h=a,_=t,d=r,i=n;const p=u.explicitOrderBy;if(d.length>p.length)throw new FirestoreError(m,`Too many arguments provided to ${_}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const E=[];for(let e=0;e<d.length;e++){const y=d[e];if(p[e].field.isKeyField()){if("string"!=typeof y)throw new FirestoreError(m,`Invalid query. Expected a string for document ID in ${_}(), but got a `+typeof y);if(!__PRIVATE_isCollectionGroupQuery(u)&&-1!==y.indexOf("/"))throw new FirestoreError(m,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${_}() must be a plain document ID, but '${y}' contains a slash.`);const h=u.path.child(ResourcePath.fromString(y));if(!DocumentKey.isDocumentKey(h))throw new FirestoreError(m,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${_}() must result in a valid document path, but '${h}' is not because it contains an odd number of segments.`);const d=new DocumentKey(h);E.push(__PRIVATE_refValue(c,d))}else{const u=__PRIVATE_parseQueryValue(h,_,y);E.push(u)}}return new Bound(E,i)}}function __PRIVATE_parseDocumentIdValue(e,t,r){if("string"==typeof(r=getModularInstance(r))){if(""===r)throw new FirestoreError(m,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!__PRIVATE_isCollectionGroupQuery(t)&&-1!==r.indexOf("/"))throw new FirestoreError(m,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);t=t.path.child(ResourcePath.fromString(r));if(DocumentKey.isDocumentKey(t))return __PRIVATE_refValue(e,new DocumentKey(t));throw new FirestoreError(m,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${t}' is not because it has an odd number of segments (${t.length}).`)}if(r instanceof DocumentReference)return __PRIVATE_refValue(e,r._key);throw new FirestoreError(m,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${__PRIVATE_valueDescription(r)}.`)}function __PRIVATE_validateDisjunctiveFilterElements(e,t){if(!Array.isArray(e)||0===e.length)throw new FirestoreError(m,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function __PRIVATE_validateNewFieldFilter(e,t){const r=function(e,t){for(const r of e)for(const e of r.getFlattenedFilters())if(0<=t.indexOf(e.op))return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new FirestoreError(m,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new FirestoreError(m,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function __PRIVATE_validateQueryFilterConstraint(e,t){if(!(t instanceof QueryFieldFilterConstraint||t instanceof QueryCompositeFilterConstraint))throw new FirestoreError(m,`Function ${e}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function __PRIVATE_applyFirestoreDataConverter(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class __PRIVATE_LiteUserDataWriter extends class{convertValue(e,t="none"){switch(__PRIVATE_typeOrder(e)){case 0:return null;case 1:return e.booleanValue;case 2:return __PRIVATE_normalizeNumber(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(__PRIVATE_normalizeByteString(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw fail()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,r="none"){const n={};return forEach(e,(e,t)=>{n[e]=this.convertValue(t,r)}),n}convertGeoPoint(e){return new GeoPoint(__PRIVATE_normalizeNumber(e.latitude),__PRIVATE_normalizeNumber(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var r=__PRIVATE_getPreviousValue(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(__PRIVATE_getLocalWriteTime(e));default:return null}}convertTimestamp(e){e=__PRIVATE_normalizeTimestamp(e);return new Timestamp(e.seconds,e.nanos)}convertDocumentKey(e,t){const r=ResourcePath.fromString(e),n=(__PRIVATE_hardAssert(__PRIVATE_isValidResourceName(r)),new DatabaseId(r.get(1),r.get(3))),i=new DocumentKey(r.popFirst(5));return n.isEqual(t)||__PRIVATE_logError(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}{constructor(e){super(),this.firestore=e}convertBytes(e){return new Bytes(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new DocumentReference(this.firestore,null,e)}}function getDoc(r){const e=__PRIVATE_getDatastore((r=__PRIVATE_cast(r,DocumentReference)).firestore),n=new __PRIVATE_LiteUserDataWriter(r.firestore);return __PRIVATE_invokeBatchGetDocumentsRpc(e,[r._key]).then(e=>{__PRIVATE_hardAssert(1===e.length);const t=e[0];return new DocumentSnapshot(r.firestore,n,r._key,t.isFoundDocument()?t:null,r.converter)})}function getDocs(r){var e=(r=__PRIVATE_cast(r,Query))._query;if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new FirestoreError(R,"limitToLast() queries require specifying at least one orderBy() clause");const t=__PRIVATE_getDatastore(r.firestore),n=new __PRIVATE_LiteUserDataWriter(r.firestore);return async function(e,t){const l=__PRIVATE_debugCast(e),r=__PRIVATE_toQueryTarget(l.serializer,__PRIVATE_queryToTarget(t));return(await l.g("RunQuery",r.parent,{structuredQuery:r.structuredQuery})).filter(e=>!!e.document).map(e=>{{var t=l.serializer,r=(e=e.document,void 0);const n=fromName(t,e.name),i=__PRIVATE_fromVersion(e.updateTime),s=e.createTime?__PRIVATE_fromVersion(e.createTime):SnapshotVersion.min(),a=new ObjectValue({mapValue:{fields:e.fields}}),o=MutableDocument.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}})}(t,r._query).then(e=>{const t=e.map(e=>new QueryDocumentSnapshot(r.firestore,n,e.key,e,r.converter));return"L"===r._query.limitType&&t.reverse(),new QuerySnapshot(r,t)})}function setDoc(e,t,r){const n=__PRIVATE_applyFirestoreDataConverter((e=__PRIVATE_cast(e,DocumentReference)).converter,t,r),i=__PRIVATE_parseSetData(__PRIVATE_newUserDataReader(e.firestore),"setDoc",e._key,n,null!==e.converter,r);return __PRIVATE_invokeCommitRpc(__PRIVATE_getDatastore(e.firestore),[i.toMutation(e._key,Precondition.none())])}function updateDoc(e,t,r,...n){var i=__PRIVATE_newUserDataReader((e=__PRIVATE_cast(e,DocumentReference)).firestore);let s;return s="string"==typeof(t=getModularInstance(t))||t instanceof FieldPath?__PRIVATE_parseUpdateVarargs(i,"updateDoc",e._key,t,r,n):__PRIVATE_parseUpdateData(i,"updateDoc",e._key,t),__PRIVATE_invokeCommitRpc(__PRIVATE_getDatastore(e.firestore),[s.toMutation(e._key,Precondition.exists(!0))])}function deleteDoc(e){return __PRIVATE_invokeCommitRpc(__PRIVATE_getDatastore((e=__PRIVATE_cast(e,DocumentReference)).firestore),[new __PRIVATE_DeleteMutation(e._key,Precondition.none())])}function addDoc(e,t){const r=doc(e=__PRIVATE_cast(e,CollectionReference)),n=__PRIVATE_applyFirestoreDataConverter(e.converter,t),i=__PRIVATE_parseSetData(__PRIVATE_newUserDataReader(e.firestore),"addDoc",r._key,n,null!==r.converter,{});return __PRIVATE_invokeCommitRpc(__PRIVATE_getDatastore(e.firestore),[i.toMutation(r._key,Precondition.exists(!1))]).then(()=>r)}function getCount(e){return getAggregate(e,{count:count()})}function getAggregate(n,e){const i=__PRIVATE_cast(n.firestore,Firestore),t=__PRIVATE_getDatastore(i),r=function(e,t){const r=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}(e,(e,t)=>new __PRIVATE_AggregateImpl(t,e.aggregateType,e._internalFieldPath));return async function(e,t,r){const n=__PRIVATE_debugCast(e),{request:i,Z:s}=function(e,t,r){const n=__PRIVATE_toQueryTarget(e,t),i={},s=[];let a=0;return r.forEach(e=>{var t="aggregate_"+a++;i[t]=e.alias,"count"===e.aggregateType?s.push({alias:t,count:{}}):"avg"===e.aggregateType?s.push({alias:t,avg:{field:__PRIVATE_toFieldPathReference(e.fieldPath)}}):"sum"===e.aggregateType&&s.push({alias:t,sum:{field:__PRIVATE_toFieldPathReference(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:s,structuredQuery:n.structuredQuery},parent:n.parent},Z:i}}(n.serializer,function(e){const t=__PRIVATE_debugCast(e);return t.O||(t.O=__PRIVATE__queryToTarget(t,e.explicitOrderBy)),t.O}(t),r),a=i.parent;n.connection.P||delete i.parent;e=(await n.g("RunAggregationQuery",a,i,1)).filter(e=>!!e.result);__PRIVATE_hardAssert(1===e.length);const o=null==(t=e[0].result)?void 0:t.aggregateFields;return Object.keys(o).reduce((e,t)=>(e[s[t]]=o[t],e),{})}(t,n._query,r).then(e=>{var t=i,r=n;return t=new __PRIVATE_LiteUserDataWriter(t),new AggregateQuerySnapshot(r,t,e)})}function sum(e){return new AggregateField("sum",__PRIVATE_fieldPathFromArgument$1("sum",e))}function average(e){return new AggregateField("avg",__PRIVATE_fieldPathFromArgument$1("average",e))}function count(){return new AggregateField("count")}function aggregateFieldEqual(e,t){return e instanceof AggregateField&&t instanceof AggregateField&&e.aggregateType===t.aggregateType&&(null==(e=e._internalFieldPath)?void 0:e.canonicalString())===(null==(e=t._internalFieldPath)?void 0:e.canonicalString())}function aggregateQuerySnapshotEqual(e,t){return queryEqual(e.query,t.query)&&deepEqual(e.data(),t.data())}function deleteField(){return new __PRIVATE_DeleteFieldValueImpl("deleteField")}function serverTimestamp(){return new __PRIVATE_ServerTimestampFieldValueImpl("serverTimestamp")}function arrayUnion(...e){return new __PRIVATE_ArrayUnionFieldValueImpl("arrayUnion",e)}function arrayRemove(...e){return new __PRIVATE_ArrayRemoveFieldValueImpl("arrayRemove",e)}function increment(e){return new __PRIVATE_NumericIncrementFieldValueImpl("increment",e)}class WriteBatch{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=__PRIVATE_newUserDataReader(e)}set(e,t,r){this._verifyNotCommitted();const n=__PRIVATE_validateReference(e,this._firestore),i=__PRIVATE_applyFirestoreDataConverter(n.converter,t,r),s=__PRIVATE_parseSetData(this._dataReader,"WriteBatch.set",n._key,i,null!==n.converter,r);return this._mutations.push(s.toMutation(n._key,Precondition.none())),this}update(e,t,r,...n){this._verifyNotCommitted();e=__PRIVATE_validateReference(e,this._firestore);let i;return i="string"==typeof(t=getModularInstance(t))||t instanceof FieldPath?__PRIVATE_parseUpdateVarargs(this._dataReader,"WriteBatch.update",e._key,t,r,n):__PRIVATE_parseUpdateData(this._dataReader,"WriteBatch.update",e._key,t),this._mutations.push(i.toMutation(e._key,Precondition.exists(!0))),this}delete(e){this._verifyNotCommitted();e=__PRIVATE_validateReference(e,this._firestore);return this._mutations=this._mutations.concat(new __PRIVATE_DeleteMutation(e._key,Precondition.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new FirestoreError(A,"A write batch can no longer be used after commit() has been called.")}}function __PRIVATE_validateReference(e,t){if((e=getModularInstance(e)).firestore!==t)throw new FirestoreError(m,"Provided document reference is from a different Firestore instance.");return e}function writeBatch(e){const t=__PRIVATE_getDatastore(e=__PRIVATE_cast(e,Firestore));return new WriteBatch(e,e=>__PRIVATE_invokeCommitRpc(t,e))}class Transaction$1{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new FirestoreError(m,"Firestore transactions require all reads to be executed before all writes.");const t=await __PRIVATE_invokeBatchGetDocumentsRpc(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new __PRIVATE_DeleteMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{t=DocumentKey.fromPath(t);this.mutations.push(new __PRIVATE_VerifyMutation(t,this.precondition(t)))}),await __PRIVATE_invokeCommitRpc(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw fail();t=SnapshotVersion.min()}var r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new FirestoreError(I,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(SnapshotVersion.min())?Precondition.exists(!1):Precondition.updateTime(t):Precondition.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return Precondition.exists(!0);if(t.isEqual(SnapshotVersion.min()))throw new FirestoreError(m,"Can't update a document that doesn't exist.");return Precondition.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}const x={maxAttempts:5};class __PRIVATE_TransactionRunner{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.ft=r.maxAttempts,this.Et=new __PRIVATE_ExponentialBackoff(this.asyncQueue,"transaction_retry")}run(){--this.ft,this.At()}At(){this.Et.K(async()=>{const t=new Transaction$1(this.datastore),e=this.Tt(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.Pt(e)}))}).catch(e=>{this.Pt(e)})})}Tt(e){try{var t=this.updateFunction(e);return!__PRIVATE_isNullOrUndefined(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Pt(e){0<this.ft&&this.Rt(e)?(--this.ft,this.asyncQueue.enqueueAndForget(()=>(this.At(),Promise.resolve()))):this.deferred.reject(e)}Rt(e){return"FirebaseError"===e.name&&("aborted"===(e=e.code)||"failed-precondition"===e||"already-exists"===e||!function(e){switch(e){default:return fail();case d:case f:case p:case y:case V:case v:case T:return;case m:case g:case"already-exists":case E:case A:case I:case P:case R:case"data-loss":return 1}}(e))}}function getDocument(){return"undefined"!=typeof document?document:null}class DelayedOperation{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new __PRIVATE_Deferred,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){const s=Date.now()+r,a=new DelayedOperation(e,t,s,n,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new FirestoreError(d,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}class __PRIVATE_AsyncQueueImpl{constructor(){this.It=Promise.resolve(),this.Vt=[],this.yt=!1,this.wt=[],this.gt=null,this.Ft=!1,this.vt=!1,this.Dt=[],this.Et=new __PRIVATE_ExponentialBackoff(this,"async_queue_retry"),this.bt=()=>{var e=getDocument();e&&__PRIVATE_logDebug("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Et.H()};const e=getDocument();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.bt)}get isShuttingDown(){return this.yt}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ct(),this.St(e)}enterRestrictedMode(e){if(!this.yt){this.yt=!0,this.vt=e||!1;const t=getDocument();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bt)}}enqueue(e){if(this.Ct(),this.yt)return new Promise(()=>{});const t=new __PRIVATE_Deferred;return this.St(()=>this.yt&&this.vt?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vt.push(e),this.Nt()))}async Nt(){if(0!==this.Vt.length){try{await this.Vt[0](),this.Vt.shift(),this.Et.reset()}catch(e){if("IndexedDbTransactionError"!==e.name)throw e;__PRIVATE_logDebug("AsyncQueue","Operation failed with retryable error: "+e)}0<this.Vt.length&&this.Et.K(()=>this.Nt())}}St(e){var t=this.It.then(()=>(this.Ft=!0,e().catch(e=>{throw this.gt=e,this.Ft=!1,__PRIVATE_logError("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return t=e.stack?e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack:t}(e)),e}).then(e=>(this.Ft=!1,e))));return this.It=t}enqueueAfterDelay(e,t,r){this.Ct(),-1<this.Dt.indexOf(e)&&(t=0);e=DelayedOperation.createAndSchedule(this,e,t,r,e=>this.Ot(e));return this.wt.push(e),e}Ct(){this.gt&&fail()}verifyOperationInProgress(){}async qt(){for(var e;await(e=this.It),e!==this.It;);}Bt(e){for(const t of this.wt)if(t.timerId===e)return!0;return!1}Qt(t){return this.qt().then(()=>{this.wt.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.wt)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.qt()})}$t(e){this.Dt.push(e)}Ot(e){e=this.wt.indexOf(e);this.wt.splice(e,1)}}class Transaction{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=__PRIVATE_newUserDataReader(e)}get(e){const r=__PRIVATE_validateReference(e,this._firestore),n=new __PRIVATE_LiteUserDataWriter(this._firestore);return this._transaction.lookup([r._key]).then(e=>{if(!e||1!==e.length)return fail();const t=e[0];if(t.isFoundDocument())return new DocumentSnapshot(this._firestore,n,t.key,t,r.converter);if(t.isNoDocument())return new DocumentSnapshot(this._firestore,n,r._key,null,r.converter);throw fail()})}set(e,t,r){e=__PRIVATE_validateReference(e,this._firestore),t=__PRIVATE_applyFirestoreDataConverter(e.converter,t,r),t=__PRIVATE_parseSetData(this._dataReader,"Transaction.set",e._key,t,null!==e.converter,r);return this._transaction.set(e._key,t),this}update(e,t,r,...n){e=__PRIVATE_validateReference(e,this._firestore),r="string"==typeof(t=getModularInstance(t))||t instanceof FieldPath?__PRIVATE_parseUpdateVarargs(this._dataReader,"Transaction.update",e._key,t,r,n):__PRIVATE_parseUpdateData(this._dataReader,"Transaction.update",e._key,t);return this._transaction.update(e._key,r),this}delete(e){e=__PRIVATE_validateReference(e,this._firestore);return this._transaction.delete(e._key),this}}function runTransaction(t,r,e){var n=__PRIVATE_getDatastore(t=__PRIVATE_cast(t,Firestore)),e=Object.assign(Object.assign({},x),e);if(e.maxAttempts<1)throw new FirestoreError(m,"Max attempts must be at least 1");var i=new __PRIVATE_Deferred;return new __PRIVATE_TransactionRunner(new __PRIVATE_AsyncQueueImpl,n,e,e=>r(new Transaction(t,e)),i).run(),i.promise}!function(){var r;r=i+"_lite",_=r,e(new Component("firestore/lite",(e,{instanceIdentifier:t,options:r})=>{const n=e.getProvider("app").getImmediate(),i=new Firestore(new __PRIVATE_LiteAuthCredentialsProvider(e.getProvider("auth-internal")),new __PRIVATE_LiteAppCheckTokenProvider(e.getProvider("app-check-internal")),function(e,t){if(Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))return new DatabaseId(e.options.projectId,t);throw new FirestoreError(m,'"projectId" not provided in firebase.initializeApp.')}(n,t),n);return r&&i._setSettings(r),i},"PUBLIC").setMultipleInstances(!0)),t("firestore-lite","4.3.2",""),t("firestore-lite","4.3.2","esm2017")}();export{AggregateField,AggregateQuerySnapshot,Bytes,CollectionReference,DocumentReference,DocumentSnapshot,FieldPath,FieldValue,Firestore,FirestoreError,GeoPoint,Query,QueryCompositeFilterConstraint,QueryConstraint,QueryDocumentSnapshot,QueryEndAtConstraint,QueryFieldFilterConstraint,QueryLimitConstraint,QueryOrderByConstraint,QuerySnapshot,QueryStartAtConstraint,Timestamp,Transaction,WriteBatch,addDoc,aggregateFieldEqual,aggregateQuerySnapshotEqual,and,arrayRemove,arrayUnion,average,collection,collectionGroup,connectFirestoreEmulator,count,deleteDoc,deleteField,doc,documentId,endAt,endBefore,getAggregate,getCount,getDoc,getDocs,getFirestore,increment,initializeFirestore,limit,limitToLast,or,orderBy,query,queryEqual,refEqual,runTransaction,serverTimestamp,setDoc,setLogLevel,snapshotEqual,startAfter,startAt,sum,terminate,updateDoc,where,writeBatch};